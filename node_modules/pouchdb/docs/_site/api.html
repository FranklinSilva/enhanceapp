<!DOCTYPE html>
<html lang="en" manifest="/manifest.appcache">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>API Reference</title>
    <link rel="alternate" title="PouchDB, the JavaScript Database that Syncs!" type="application/rss+xml" href="/feed.xml">
    <link rel="stylesheet" href="/static/css/pouchdb.css" />
    <meta name="theme-color" content="#6ccb99">
    <meta name="msapplication-TileColor" content="#6ccb99">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42479701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
  </head>

  <body data-spy="scroll" data-target="#sidebar">

    <header>

      <a href="https://github.com/pouchdb/pouchdb" target="_blank">
         <div class="ribbon">GitHub</div>
      </a>

      <div class="container">

        <a class="logo" href="/">
          <div class="logo-img"></div>
          <span class='logo-type'>PouchDB</span>
        </a>

        <ul class='nav nav-header nav-pills'>
          <li>
            <a class='btn btn-link btn-lg' href="/blog/">Blog</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/guides/">Guides</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/api.html">API</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/learn.html">Learn</a>
          </li>
          <li>
            <a
                class='btn btn-primary btn-lg'
                href="https://github.com/pouchdb/pouchdb/releases/download/3.5.0/pouchdb-3.5.0.min.js"
            >
                Download <strong>v3.5.0</strong>
            </a>
          </li>
        </ul>

      </div>

    </header>
    
      <div class="page-head">

        <div class="container">

          <h1>API Reference</h1>
          

        </div>

      </div>
    


    <article>
  <div class="container">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
          <div data-spy="affix" data-offset-top="214" data-offset-bottom="450">
            <ul class="nav nav-silent nav-sidebar">
              <li><a href="#overview">API overview</a></li>
<li><a href="#create_database">Create database</a></li>
<li><a href="#delete_database">Delete database</a></li>
<li><a href="#create_document">Create/update doc</a></li>
<li><a href="#fetch_document">Fetch doc</a></li>
<li><a href="#delete_document">Delete doc</a></li>
<li><a href="#batch_create">Batch create</a></li>
<li><a href="#batch_fetch">Batch fetch</a></li>
<li><a href="#changes">Changes</a></li>
<li><a href="#replication">Replication</a></li>
<li><a href="#sync">Sync</a></li>
<li><a href="#save_attachment">Save attachment</a></li>
<li><a href="#get_attachment">Get attachment</a></li>
<li><a href="#delete_attachment">Delete attachment</a></li>
<li><a href="#query_database">Query database</a></li>
<li><a href="#view_cleanup">View cleanup</a></li>
<li><a href="#database_information">Database info</a></li>
<li><a href="#compaction">Compaction</a></li>
<li><a href="#revisions_diff">Revision diff</a></li>
<li><a href="#events">Events</a></li>
<li><a href="#defaults">Default settings</a></li>
<li><a href="#plugins">Plugins</a></li>
<li><a href="#extras">Extras</a></li>
<li><a href="#debug_mode">Debug mode</a></li>

            </ul>
          </div>
        </div>

        <div class="col-sm-9">
          
<div id="overview"></div>
<p><a class="h2 anchor" href="#overview" name="overview">API overview</a></p>

<p>PouchDB has an asynchronous API, supporting both <a href="http://docs.nodejitsu.com/articles/getting-started/control-flow/what-are-callbacks">callbacks</a> and <a href="https://www.promisejs.org/">promises</a>.</p>

<p>Most of the API is exposed as:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">args</span><span class="p">...,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>… where both the <code>options</code> and <code>callback</code> are optional.</p>

<p>Callbacks use the standard Node.js idiom of:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span></code></pre></div>

<p>… where the <code>error</code> will be undefined if there’s no error.</p>

<p>If you don’t specify a <code>callback</code>, then the API returns a <a href="https://www.promisejs.org/">promise</a>. In <a href="http://caniuse.com/#feat=promises">supported browsers</a>, native promises are used, falling back to the minimal library <a href="https://github.com/calvinmetcalf/lie">lie</a> as needed. In Node.js, promises come from <a href="https://github.com/petkaantonov/bluebird">Bluebird</a>.</p>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>Using Ionic/Angular?</strong>  You can wrap PouchDB promises in <a href="https://docs.angularjs.org/api/ng/service/$q#when"><code>$q.when()</code></a>. This will notify Angular to update the UI when the PouchDB promise has resolved.</p>


</div></div>

<p>For more info, check out the <a href="/guides/async-code.html">guide to asynchronous code</a>.</p>

<div id="create_database"></div>
<p><a class="h2 anchor" href="#create_database" name="create_database">Create a database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">new</span> <span class="nx">PouchDB</span><span class="p">([</span><span class="nx">name</span><span class="p">],</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></div>

<p>This method creates a database or opens an existing one. If you use a URL like <code>'http://domain.com/dbname'</code>, then PouchDB will work as a client to an online CouchDB instance.  Otherwise it will create a local database using <a href="/adapters.html">whatever backend is present</a>.</p>

<h3 id="options">Options</h3>

<ul>
  <li><code>name</code>: You can omit the <code>name</code> argument and specify it via <code>options</code> instead. Note that the name is required.</li>
</ul>

<p><strong>Options for local databases:</strong></p>

<ul>
  <li><code>auto_compaction</code>: This turns on auto compaction, which means <code>compact()</code> is called after every change to the database. Defaults to <code>false</code>.</li>
  <li><code>adapter</code>: One of <code>'idb'</code>, <code>'leveldb'</code>, <code>'websql'</code>, or <code>'http'</code>. If unspecified, PouchDB will infer this automatically, preferring IndexedDB to WebSQL in browsers that support both (i.e. Chrome, Opera and Android 4.4+).</li>
</ul>

<p><strong>Options for remote databases:</strong></p>

<ul>
  <li><code>ajax</code>: (Remote databases only.) Ajax requester options. For instance, passing in the options <code>{ajax: {timeout: 10000}}</code> will allow you to set the max timeout for an HTTP request. These are passed ver batim to <a href="https://github.com/mikeal/request">request</a> (in Node.js) or  <a href="https://github.com/pouchdb/pouchdb/blob/master/lib/deps/request-browser.js">a request shim</a> (in the browser), with the exception of:</li>
  <li><code>ajax.cache</code>: Appends a random string to the end of all HTTP GET requests to avoid them being cached on IE. Set this to <code>true</code> to prevent this happening.</li>
  <li><code>ajax.headers</code>: The <code>ajax.headers</code> option allows you to customise headers that are sent to the remote HTTP Server.</li>
  <li><code>auth.username</code> + <code>auth.password</code>: You can specify HTTP auth parameters either by using a database with a name in the form <code>http://user:pass@host/name</code> or via the <code>auth.username</code> + <code>auth.password</code> options.</li>
</ul>

<p><strong>WebSQL-only options:</strong></p>

<ul>
  <li><code>size</code>: amount in MB to request for storage, which you will need if you are storing &gt;5MB in order to avoid storage limit errors on iOS/Safari. Details <a href="/errors.html#not_enough_space">here</a>.</li>
</ul>

<p><strong>SQLite Plugin-only options:</strong></p>

<ul>
  <li><code>location</code>: where to store data on iOS, which may affect iTunes/iCloud backup, and thus whether or not your app gets rejected by Apple. See <a href="https://github.com/brodysoft/Cordova-SQLitePlugin/#opening-a-database">SQLite Plugin documentation</a> and <a href="https://developer.apple.com/icloud/documentation/data-storage/index.html">iOS data storage guidelines</a>.</li>
  <li><code>createFromLocation</code>: use a pre-populated database, so you can package it with your app and users don’t have to wait for it to load. See the <a href="https://github.com/brodysoft/Cordova-SQLitePlugin/#pre-populated-database">SQLite Plugin documentation</a>.</li>
  <li><code>androidDatabaseImplementation</code>: <code>1</code> to use the new <code>sqlite4java</code> implementation, <code>2</code> to use the older version based on the native Android APIs. Defaults to <code>1</code>. See the <a href="https://github.com/litehelpers/Cordova-sqlite-storage#android-sqlite-implementation">SQLite Plugin documentation</a>.</li>
</ul>

<p><strong>Notes:</strong></p>

<ol>
  <li>In IndexedDB and WebSQL, PouchDB will use <code>_pouch_</code> to prefix the internal database names. Do not manually create databases with the same prefix.</li>
  <li>When acting as a client on Node, any other options given will be passed to <a href="https://github.com/mikeal/request">request</a>.</li>
  <li>When using the <code>'leveldb'</code> adapter (the default on Node), any other options given will be passed to <a href="https://github.com/rvagg/node-levelup">levelup</a>. The storage layer of leveldb can be replaced by passing a level backend factory (such as <a href="https://github.com/rvagg/memdown">MemDOWN</a>) as <code>options.db</code>. The rest of the supported options are <a href="https://github.com/rvagg/node-levelup/#options">documented here</a>.</li>
</ol>

<h4 id="example-usage">Example Usage:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;http://localhost:5984/dbname&#39;</span><span class="p">);</span></code></pre></div>

<p>Create a WebSQL-only Pouch (e.g. when using the <a href="https://github.com/brodysoft/Cordova-SQLitePlugin">SQLite Plugin</a> for Cordova/PhoneGap):</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">adapter</span> <span class="o">:</span> <span class="s1">&#39;websql&#39;</span><span class="p">});</span></code></pre></div>

<p>Create an in-memory Pouch (in Node):</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">db</span> <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;memdown&#39;</span><span class="p">)});</span></code></pre></div>

<p>Create a remote PouchDB with special Ajax options:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;http://example.com/dbname&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">ajax</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">cache</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">timeout</span><span class="o">:</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;X-Some-Special-Header&#39;</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="nx">auth</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;mysecretusername&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;mysecretpassword&#39;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p>For more info, check out <a href="/adapters.html">adapters</a>.</p>

<div id="delete_database"></div>
<p><a class="h2 anchor" href="#delete_database" name="delete_database">Delete a database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Delete the database. Note that this has no impact on other replicated databases.</p>

<h3 id="options-1">Options</h3>

<ul>
  <li><code>options.ajax</code>: (Remote databases only.) Ajax requester options, <a href="#create_database">as described above</a>.</li>
</ul>

<h4 id="example-usage-1">Example Usage</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="destroy_db" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// success</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="destroy_db" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// success</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<div id="create_document"></div>
<p><a class="h2 anchor" href="#create_document" name="create_document">Create/update a document</a></p>

<h3 id="using-dbput">Using db.put()</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">docId</span><span class="p">],</span> <span class="p">[</span><span class="nx">docRev</span><span class="p">],</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Create a new document or update an existing document. If the document already exists, you must specify its revision <code>_rev</code>, otherwise a conflict will occur.</p>

<p>There are some restrictions on valid property names of the documents. These are explained <a href="http://wiki.apache.org/couchdb/HTTP_Document_API#Special_Fields">here</a>.</p>

<h4 id="example-usage-2">Example Usage:</h4>

<p>Create a new doc with an <code>_id</code> of <code>'mydoc'</code>:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="newDoc" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Heroes&#39;</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle response</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="newDoc" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Heroes&#39;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle response</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>You can update an existing doc using <code>_rev</code>:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="updateDoc" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
    <span class="nx">_rev</span><span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Let&#39;s Dance&quot;</span>
  <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="updateDoc" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
    <span class="nx">_rev</span><span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Let&#39;s Dance&quot;</span>
  <span class="p">});</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle response</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>Instead of including the <code>_id</code> and <code>_rev</code> in the document, you can 
also pass them in as options:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="updateDoc2" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Sound and Vision&quot;</span>
  <span class="p">},</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="updateDoc2" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Sound and Vision&quot;</span>
  <span class="p">},</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle response</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;</span>
<span class="p">}</span></code></pre></div>

<p>The response contains the <code>id</code> of the document, the new <code>rev</code>, and an <code>ok</code> to reassure
you that everything is okay.</p>

<h3 id="using-dbpost">Using db.post()</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Create a new document and let PouchDB auto-generate an <code>_id</code> for it.</p>

<h4 id="example-usage-3">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="post_doc" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Ziggy Stardust&#39;</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle response</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="post_doc" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Ziggy Stardust&#39;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle response</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-1">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;8A2C3761-FFD5-4770-9B8C-38C33CED300A&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;1-d3a8e0e5aa7c8fff0c376dac2d8a4007&quot;</span>
<span class="p">}</span></code></pre></div>

<p><strong>Put vs. post</strong>: The basic rule of thumb is: <code>put()</code> new documents with an <code>_id</code>, <code>post()</code> new documents without an <code>_id</code>.</p>

<p>You should also prefer <code>put()</code> to <code>post()</code>, because when you <code>post()</code>, you are missing an opportunity to use <code>allDocs()</code> to sort documents by <code>_id</code> (because your <code>_id</code>s are random). For more info, read the <a href="/2014/06/17/12-pro-tips-for-better-code-with-pouchdb.html">PouchDB pro tips</a>.</p>

<div id="fetch_document"></div>
<p><a class="h2 anchor" href="#fetch_document" name="fetch_document">Fetch a document</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Retrieves a document, specified by <code>docId</code>.</p>

<h3 id="options-2">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>options.rev</code>: Fetch specific revision of a document. Defaults to winning revision (see <a href="http://guide.couchdb.org/draft/conflicts.html">the CouchDB guide</a>).</li>
  <li><code>options.revs</code>: Include revision history of the document.</li>
  <li><code>options.revs_info</code>: Include a list of revisions of the document, and their availability.</li>
  <li><code>options.open_revs</code>: Fetch all leaf revisions if <code>open_revs="all"</code> or fetch all leaf revisions specified in <code>open_revs</code> array. Leaves will be returned in the same order as specified in input array.</li>
  <li><code>options.conflicts</code>: If specified, conflicting leaf revisions will be attached in <code>_conflicts</code> array.</li>
  <li><code>options.attachments</code>: Include attachment data.</li>
  <li><code>options.local_seq</code> (<em>DEPRECATED</em>): Include sequence number of the revision in the database, this will be removed in the next major version.</li>
  <li><code>options.ajax</code>: An object of options to be sent to the ajax requester. In Node they are sent verbatim to <a href="https://github.com/mikeal/request">request</a> with the exception of:</li>
  <li><code>options.ajax.cache</code>: Appends a random string to the end of all HTTP GET requests to avoid them being cached on IE. Set this to <code>true</code> to prevent this happening.</li>
</ul>

<h4 id="example-usage-4">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="get1" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle doc</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="get1" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle doc</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-2">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Rock and Roll Heart&quot;</span><span class="p">,</span>
<span class="p">}</span></code></pre></div>

<p>The response contains the document as it is stored in the database, along with its
<code>_id</code> and <code>_rev</code>.</p>

<div id="delete_document"></div>
<p><a class="h2 anchor" href="#delete_document" name="delete_document">Delete a document</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Or:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">docRev</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Deletes the document. <code>doc</code> is required to be a document with at least an <code>_id</code> and a <code>_rev</code> property. Sending the full document will work as well.</p>

<h4 id="example-usage-5">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="delete_doc" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="delete_doc" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-3">Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;2-9AF304BE281790604D1D8A4B0F4C9ADB&quot;</span>
<span class="p">}</span></code></pre></div>

<p>You can also delete a document by just providing an <code>id</code> and <code>rev</code>:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="delete_doc3" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="delete_doc3" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>You can also delete a document by using <code>put()</code> with <code>{_deleted: true}</code>:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="delete_doc2" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">doc</span><span class="p">.</span><span class="nx">_deleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="delete_doc2" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">doc</span><span class="p">.</span><span class="nx">_deleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<div id="batch_create"></div>
<p><a class="h2 anchor" href="#batch_create" name="batch_create">Create/update a batch of documents</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">(</span><span class="nx">docs</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Create, update or delete multiple documents. The <code>docs</code> argument is an array of documents.</p>

<p>If you omit an <code>_id</code> parameter on a given document, the database will create a new document and assign the ID for you. To update a document, you must include both an <code>_id</code> parameter and a <code>_rev</code> parameter, which should match the ID and revision of the document on which to base your updates. Finally, to delete a document, include a <code>_deleted</code> parameter with the value <code>true</code>.</p>

<h4 id="example-usage-6">Example Usage:</h4>

<p>Put some new docs, providing the <code>_id</code>s:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="bulk_docs_1" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span> <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;doc1&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">,</span> <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;doc2&#39;</span><span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="bulk_docs_1" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span> <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;doc1&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">,</span> <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;doc2&#39;</span><span class="p">}</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>Post some new docs and auto-generate the <code>_id</code>s:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="bulk_docs_2" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="bulk_docs_2" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">}</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-4">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-84abc2a942007bee7cf55007cba56198&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-7b80fc50b6af7a905f368670429a757e&quot;</span>
  <span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>The response contains an array of the familiar <code>ok</code>/<code>rev</code>/<code>id</code> 
from the <a href="#create_document">put()/post() API</a>. If there are any errors, they
will be provided individually like so:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="p">{</span> <span class="nx">status</span><span class="o">:</span> <span class="mi">409</span><span class="p">,</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;conflict&#39;</span><span class="p">,</span>
    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Document update conflict&#39;</span><span class="p">,</span>
    <span class="nx">error</span><span class="o">:</span> <span class="kc">true</span> 
  <span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>Note that <code>bulkDocs()</code> is not transactional, and that you may get
back a mixed array of errors/non-errors. In CouchDB/PouchDB, the smallest
atomic unit is the document.</p>

<h4 id="bulk-updatedelete">Bulk update/delete:</h4>

<p>You can also use <code>bulkDocs()</code> to update/delete many documents at once:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="bulk_docs3" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span>
    <span class="nx">artist</span> <span class="o">:</span> <span class="s1">&#39;Velvet Underground&#39;</span><span class="p">,</span>
    <span class="nx">_id</span>    <span class="o">:</span> <span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
    <span class="nx">_rev</span>   <span class="o">:</span> <span class="s2">&quot;1-84abc2a942007bee7cf55007cba56198&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">,</span>
    <span class="nx">artist</span> <span class="o">:</span> <span class="s1">&#39;David Bowie&#39;</span><span class="p">,</span>
    <span class="nx">_id</span>    <span class="o">:</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
    <span class="nx">_rev</span>   <span class="o">:</span> <span class="s2">&quot;1-7b80fc50b6af7a905f368670429a757e&quot;</span>
  <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="bulk_docs3" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span>
    <span class="nx">artist</span> <span class="o">:</span> <span class="s1">&#39;Velvet Underground&#39;</span><span class="p">,</span>
    <span class="nx">_id</span>    <span class="o">:</span> <span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
    <span class="nx">_rev</span>   <span class="o">:</span> <span class="s2">&quot;1-84abc2a942007bee7cf55007cba56198&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">,</span>
    <span class="nx">artist</span> <span class="o">:</span> <span class="s1">&#39;David Bowie&#39;</span><span class="p">,</span>
    <span class="nx">_id</span>    <span class="o">:</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
    <span class="nx">_rev</span>   <span class="o">:</span> <span class="s2">&quot;1-7b80fc50b6af7a905f368670429a757e&quot;</span>
  <span class="p">}</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>Or delete them:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="bulk_docs_4" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="nx">title</span>    <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span>
    <span class="nx">_deleted</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">_id</span>      <span class="o">:</span> <span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
    <span class="nx">_rev</span>     <span class="o">:</span> <span class="s2">&quot;1-84abc2a942007bee7cf55007cba56198&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">title</span>    <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">,</span>
    <span class="nx">_deleted</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">_id</span>      <span class="o">:</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
    <span class="nx">_rev</span>     <span class="o">:</span> <span class="s2">&quot;1-7b80fc50b6af7a905f368670429a757e&quot;</span>
  <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="bulk_docs_4" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="nx">title</span>    <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span>
    <span class="nx">_deleted</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">_id</span>      <span class="o">:</span> <span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
    <span class="nx">_rev</span>     <span class="o">:</span> <span class="s2">&quot;1-84abc2a942007bee7cf55007cba56198&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">title</span>    <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">,</span>
    <span class="nx">_deleted</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">_id</span>      <span class="o">:</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
    <span class="nx">_rev</span>     <span class="o">:</span> <span class="s2">&quot;1-7b80fc50b6af7a905f368670429a757e&quot;</span>
  <span class="p">}</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong>Note:</strong> You can also specify a <code>new_edits</code> property on the options object that when set to <code>false</code> allows you to post and overwrite <a href="http://wiki.apache.org/couchdb/HTTP_Bulk_Document_API#Posting_Existing_Revisions">existing documents</a>. Normally only the replication algorithm needs to do this.</p>

<div id="batch_fetch"></div>
<p><a class="h2 anchor" href="#batch_fetch" name="batch_fetch">Fetch a batch of documents</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Fetch multiple documents, indexed and sorted by the <code>_id</code>.  Deleted documents are only included if <code>options.keys</code> is specified.</p>

<h3 id="options-3">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>options.include_docs</code>: Include the document itself in each row in the <code>doc</code> field. Otherwise by default you only get the <code>_id</code> and <code>_rev</code> properties.
    <ul>
      <li><code>options.conflicts</code>: Include conflict information in the <code>_conflicts</code> field of a doc.</li>
      <li><code>options.attachments</code>: Include attachment data as base64-encoded string.</li>
    </ul>
  </li>
  <li><code>options.startkey</code> &amp; <code>options.endkey</code>: Get documents with IDs in a certain range (inclusive/inclusive).</li>
  <li><code>options.inclusive_end</code>: Include documents having an ID equal to the given <code>options.endkey</code>. Default: <code>true</code>.</li>
  <li><code>options.limit</code>: Maximum number of documents to return.</li>
  <li><code>options.skip</code>: Number of docs to skip before returning (warning: poor performance on IndexedDB/LevelDB!).</li>
  <li><code>options.descending</code>: Reverse the order of the output documents.</li>
  <li><code>options.key</code>: Only return documents with IDs matching this string key.</li>
  <li><code>options.keys</code>: Array of string keys to fetch in a single shot.
    <ul>
      <li>Neither <code>startkey</code> nor <code>endkey</code> can be specified with this option.</li>
      <li>The rows are returned in the same order as the supplied <code>keys</code> array.</li>
      <li>The row for a deleted document will have the revision ID of the deletion, and an extra key <code>"deleted":true</code> in the <code>value</code> property.</li>
      <li>The row for a nonexistent document will just contain an <code>"error"</code> property with the value <code>"not_found"</code>.</li>
      <li>For details, see the <a href="http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options">CouchDB query options documentation</a>.</li>
    </ul>
  </li>
</ul>

<p><strong>Notes:</strong> For pagination, <code>options.limit</code> and <code>options.skip</code> are also available, but the same performance concerns as in CouchDB apply. Use the <a href="http://docs.couchdb.org/en/latest/couchapp/views/pagination.html">startkey/endkey pattern</a> instead.</p>

<h4 id="example-usage-7">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="all_docs" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="nx">attachments</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="all_docs" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="nx">attachments</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-5">Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
      <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span><span class="p">,</span>
      <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Sound and Vision&quot;</span><span class="p">,</span>
      <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
      	<span class="s2">&quot;attachment/its-id&quot;</span><span class="o">:</span> <span class="p">{</span>
      	  <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;image/jpg&quot;</span><span class="p">,</span>
      	  <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==&quot;</span><span class="p">,</span>
      	  <span class="s2">&quot;digest&quot;</span><span class="o">:</span> <span class="s2">&quot;md5-57e396baedfe1a034590339082b9abce&quot;</span>
      	<span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
   <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
   <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
   <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span>
   <span class="p">}</span>
 <span class="p">}]</span>
<span class="p">}</span></code></pre></div>

<p>In the response, you have three things:</p>

<ul>
  <li><code>total_rows</code> the total number of non-deleted documents in the database</li>
  <li><code>offset</code> the <code>skip</code> if provided, or in CouchDB the actual offset</li>
  <li><code>rows</code>: rows containing the documents, or just the <code>_id</code>/<code>_revs</code> if you didn’t set <code>include_docs</code> to <code>true</code>.</li>
</ul>

<p>You can use <code>startkey</code>/<code>endkey</code> to find all docs in a range:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="all_docs_2" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="nx">attachments</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">startkey</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
  <span class="nx">endkey</span><span class="o">:</span> <span class="s1">&#39;quux&#39;</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="all_docs_2" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="nx">attachments</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">startkey</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
  <span class="nx">endkey</span><span class="o">:</span> <span class="s1">&#39;quux&#39;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>This will return all docs with <code>_id</code>s between <code>'bar'</code> and <code>'quux'</code>.</p>

<h4 id="prefix-search">Prefix search</h4>

<p>You can do prefix search in <code>allDocs()</code> – i.e. “give me all the documents whose <code>_id</code>s start with <code>'foo'</code>” – by using the special high Unicode character <code>'\uffff'</code>:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="all_docs_3" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="nx">attachments</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">startkey</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
  <span class="nx">endkey</span><span class="o">:</span> <span class="s1">&#39;foo\uffff&#39;</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="all_docs_3" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="nx">attachments</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">startkey</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
  <span class="nx">endkey</span><span class="o">:</span> <span class="s1">&#39;foo\uffff&#39;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>This works because CouchDB/PouchDB <code>_id</code>s are sorted <a href="http://docs.couchdb.org/en/latest/couchapp/views/collation.html">lexicographically</a>.</p>

<div id="changes"></div>
<p><a class="h2 anchor" href="#changes" name="changes">Listen to database changes</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span></code></pre></div>

<p>A list of changes made to documents in the database, in the order they were made.
It returns an object with the method <code>cancel()</code>, which you call if you don’t want to listen to new changes anymore.</p>

<p>It is an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">event emitter</a> and will emit a <code>'change'</code> event on each document change, a <code>'complete'</code> event when all the changes have been processed, and an <code>'error'</code> event when an error occurs. In addition to the <code>'change'</code> event, any change will also emit a <code>'create'</code>, <code>'update'</code>, or <code>'delete'</code> event.</p>

<h3 id="options-4">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>options.live</code>: Does “live” changes, using CouchDB’s  <code>_longpoll_</code> feed if remote.</li>
  <li><code>options.include_docs</code>: Include the associated document with each change.
    <ul>
      <li><code>options.conflicts</code>: Include conflicts.</li>
      <li><code>options.attachments</code>: Include attachments.</li>
    </ul>
  </li>
  <li><code>options.descending</code>: Reverse the order of the output documents.</li>
  <li><code>options.since</code>: Start the results from the change immediately after the given sequence number. You can also pass <code>'now'</code> if you want only new changes (when <code>live</code> is <code>true</code>).</li>
  <li><code>options.limit</code>: Limit the number of results to this number.</li>
  <li><code>options.timeout</code>: Request timeout (in milliseconds).</li>
</ul>

<p><strong>Filtering Options:</strong></p>

<ul>
  <li><code>options.filter</code>: Reference a filter function from a design document to selectively get updates. To use a view function, pass <code>_view</code> here and provide a reference to the view function in <code>options.view</code>. See <a href="#filtered-changes">filtered changes</a> for details.</li>
  <li><code>options.doc_ids</code>: Only show changes for docs with these ids (array of strings).</li>
  <li><code>options.query_params</code>: Object containing properties that are passed to the filter function, e.g. <code>{"foo:"bar"}</code>, where <code>"bar"</code> will be available in the filter function as <code>params.query.foo</code>. To access the <code>params</code>, define your filter function like <code>function (doc, params) {/* ... */}</code>.</li>
  <li><code>options.view</code>: Specify a view function (e.g. <code>'design_doc_name/view_name'</code>) to act as a filter. Documents counted as “passed” for a view filter if a map function emits at least one record for them. <strong>Note</strong>: <code>options.filter</code> must be set to <code>'_view'</code> for this option to work.</li>
</ul>

<p><strong>Advanced Options:</strong></p>

<ul>
  <li><code>options.returnDocs</code>: Is available for non-http databases and defaults to <code>true</code>. Passing <code>false</code> prevents the changes feed from keeping all the documents in memory – in other words complete always has an empty results array, and the <code>change</code> event is the only way to get the event. Useful for large change sets where otherwise you would run out of memory.</li>
  <li><code>options.batch_size</code>: Only available for http databases, this configures how many changes to fetch at a time. Increasing this can reduce the number of requests made. Default is 25.</li>
  <li><code>options.style</code>: Specifies how many revisions are returned in the changes array. The default, <code>'main_only'</code>, will only return the current “winning” revision; <code>'all_docs'</code> will return all leaf revisions (including conflicts and deleted former conflicts). Most likely you won’t need this unless you’re writing a replicator.</li>
</ul>

<h4 id="example-usage-8">Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">changes</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">since</span><span class="o">:</span> <span class="s1">&#39;now&#39;</span><span class="p">,</span>
  <span class="nx">live</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">change</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle change</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// changes() was canceled</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">changes</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></div>

<h4 id="example-response-6">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;somestuff&quot;</span><span class="p">,</span>
  <span class="s2">&quot;seq&quot;</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span>
  <span class="s2">&quot;changes&quot;</span><span class="o">:</span><span class="p">[{</span>
    <span class="s2">&quot;rev&quot;</span><span class="o">:</span><span class="s2">&quot;1-8e6e4c0beac3ec54b27d1df75c7183a8&quot;</span>
  <span class="p">}],</span>
  <span class="s2">&quot;doc&quot;</span><span class="o">:</span><span class="p">{</span>
    <span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Ch-Ch-Ch-Ch-Changes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;someDocId&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_rev&quot;</span><span class="o">:</span><span class="s2">&quot;1-8e6e4c0beac3ec54b27d1df75c7183a8&quot;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<h4 id="change-events">Change events</h4>

<ul>
  <li><strong><code>change</code></strong> (<code>info</code>) - This event fires when a change has been found. <code>info</code> will contain details about the change, such as whether it was deleted and what the new <code>_rev</code> is. <code>info.doc</code> will contain the doc if you set <code>include_docs</code> to <code>true</code>. See below for an example response.</li>
  <li><strong><code>complete</code></strong> (<code>info</code>) - This event fires when all changes have been read. In live changes, only cancelling the changes should trigger this event. <code>info.results</code> will contain the list of changes. See below for an example.</li>
  <li><strong><code>error</code></strong> (<code>err</code>) - This event is fired when the replication is stopped due to an unrecoverable failure.</li>
</ul>

<h4 id="example-response-7">Example response</h4>

<p>Example response in the <code>'change'</code> listener (using <code>{include_docs: true}</code>):</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;doc1&#39;</span><span class="p">,</span>
  <span class="nx">changes</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">rev</span><span class="o">:</span> <span class="s1">&#39;1-9152679630cc461b9477792d93b83eae&#39;</span> <span class="p">}</span> <span class="p">],</span>
  <span class="nx">doc</span><span class="o">:</span> <span class="p">{</span> 
    <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;doc1&#39;</span><span class="p">,</span> 
    <span class="nx">_rev</span><span class="o">:</span> <span class="s1">&#39;1-9152679630cc461b9477792d93b83eae&#39;</span> 
  <span class="p">},</span>
  <span class="nx">seq</span><span class="o">:</span> <span class="mi">1</span> 
<span class="p">}</span></code></pre></div>

<p>Example response in the <code>'change'</code> listener when a doc was deleted:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;doc2&#39;</span><span class="p">,</span>
  <span class="nx">changes</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">rev</span><span class="o">:</span> <span class="s1">&#39;2-9b50a4b63008378e8d0718a9ad05c7af&#39;</span> <span class="p">}</span> <span class="p">],</span>
  <span class="nx">doc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;doc2&#39;</span><span class="p">,</span>
    <span class="nx">_rev</span><span class="o">:</span> <span class="s1">&#39;2-9b50a4b63008378e8d0718a9ad05c7af&#39;</span><span class="p">,</span>
    <span class="nx">_deleted</span><span class="o">:</span> <span class="kc">true</span> 
  <span class="p">},</span>
  <span class="nx">deleted</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">seq</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">}</span></code></pre></div>

<p>Example response in the <code>'complete'</code> listener:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;results&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-9152679630cc461b9477792d93b83eae&quot;</span> <span class="p">}</span> <span class="p">],</span>
      <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-9152679630cc461b9477792d93b83eae&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
      <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span> <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;2-9b50a4b63008378e8d0718a9ad05c7af&quot;</span> <span class="p">}</span> <span class="p">],</span>
      <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;2-9b50a4b63008378e8d0718a9ad05c7af&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_deleted&quot;</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="s2">&quot;deleted&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">3</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;last_seq&quot;</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">}</span></code></pre></div>

<p><code>seq</code> and <code>last_seq</code> correspond to the overall sequence number of the entire database, and it’s what is passed in when using <code>since</code> (except for the special <code>'now'</code>). It is the primary key for the changes feed, and is also used as a checkpointer by the replication algorithm.</p>

<h4 id="single-shot">Single-shot</h4>

<p>If you don’t specify <code>{live: true}</code>, then you can also use <code>changes()</code> in the standard
callback/promise style, and it will be treated as a single-shot request, which
returns a list of the changes (i.e. what the <code>'complete'</code> event emits):</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="changes1" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">limit</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nx">since</span><span class="o">:</span> <span class="mi">0</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="changes1" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">limit</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nx">since</span><span class="o">:</span> <span class="mi">0</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-8">Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;results&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;otherdoc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-3753476B70A49EA4D8C9039E7B04254C&quot;</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;828124B9-3973-4AF3-9DFD-A94CE4544005&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-A8BC08745E62E58830CA066D99E5F457&quot;</span>
    <span class="p">}]</span>
  <span class="p">}]</span>
<span class="p">}</span></code></pre></div>

<p>When <code>live</code> is <code>false</code>, the returned object is also an event emitter as well as a promise,
and will fire the <code>'complete'</code> event when the results are ready.</p>

<p>Note that this <code>'complete'</code> event only fires when you aren’t doing live changes. With live changes, use the <code>'paused'</code> event instead.</p>

<h4 id="filtered-changes">Filtered changes</h4>

<p>As with <a href="#replication">replicate()</a>, you can filter using:</p>

<ul>
  <li>an ad-hoc <code>filter</code> function</li>
  <li>an array of <code>doc_ids</code></li>
  <li>a <code>filter</code> function inside of a design document</li>
  <li>a <code>filter</code> function inside of a design document, with <code>query_params</code></li>
  <li>a <code>view</code> function inside of a design document</li>
</ul>

<p>If you are running <code>changes()</code> on a remote CouchDB, then the first method will run client-side, whereas the last four will filter on the server side. Therefore the last four should be preferred, especially if the database is large, because you want to send as few documents over the wire as possible.</p>

<p>If you are running <code>changes()</code> on a local PouchDB, then obviously all five methods will run client-side. There are also no performance benefits to using any of the five, so can also just filter yourself, in your own <code>on('change')</code> handler. These methods are implemented in PouchDB purely for consistency with CouchDB.</p>

<h4 id="filtering-examples">Filtering examples</h4>

<p>In these examples, we’ll work with some mammals. Let’s imagine our docs are:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="p">{</span><span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Kangaroo&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Koala&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Platypus&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;monotreme&#39;</span><span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>Here are 5 examples using the 5 different systems.</p>

<p><strong>Example 1: Ad-hoc <code>filter</code> function</strong></p>

<p><em>Warning</em>: this runs client-side, if the database is remote.</p>

<p>Filter by <code>type === 'marsupial'</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p><strong>Example 2: Array of <code>doc_ids</code></strong></p>

<p>Filter documents with <code>_id</code>s <code>['a', 'c']</code>.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">doc_ids</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="p">});</span></code></pre></div>

<p><strong>Example 3: <code>filter</code> function inside of a design document</strong></p>

<p>First <code>put()</code> a design document:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;_design/mydesign&#39;</span><span class="p">,</span>
  <span class="nx">filters</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">myfilter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">filter</span><span class="o">:</span> <span class="s1">&#39;mydesign/myfilter&#39;</span>
<span class="p">});</span></code></pre></div>

<p><strong>Example 4: <code>filter</code> function inside of a design document, with <code>query_params</code></strong></p>

<p>This is the most powerful way to filter, because it allows you to pass in arbitrary options to your filter function.</p>

<p>First <code>put()</code> a design document:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;_design/mydesign&#39;</span><span class="p">,</span>
  <span class="nx">filters</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">myfilter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">filter</span><span class="o">:</span> <span class="s1">&#39;mydesign/myfilter&#39;</span><span class="p">,</span>
  <span class="nx">query_params</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p><strong>Example 5: <code>view</code> function inside of a design document</strong></p>

<p>This doesn’t really offer any advantages compared to the previous two methods, unless you are already using a <code>view</code> for map/reduce queries, and you want to reuse it.</p>

<p>Any documents that <code>emit()</code> anything will be considered to have passed this filter method.</p>

<p>First <code>put()</code> a design document:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;_design/mydesign&#39;</span><span class="p">,</span>
  <span class="nx">views</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">myview</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">filter</span><span class="o">:</span> <span class="s1">&#39;_view&#39;</span><span class="p">,</span>
  <span class="nx">view</span><span class="o">:</span> <span class="s1">&#39;mydesign/myview&#39;</span>
<span class="p">});</span></code></pre></div>

<div id="replication"></div>
<p><a class="h2 anchor" href="#replication" name="replication">Replicate a database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></div>

<p>Replicate data from <code>source</code> to <code>target</code>.  Both the <code>source</code> and <code>target</code> can be a PouchDB instance or a string representing a CouchDB database URL or the name of a local PouchDB database. If <code>options.live</code> is <code>true</code>, then this will track future changes and also replicate them automatically. This method returns an object with the method <code>cancel()</code>, which you call if you want to cancel live replication.</p>

<p>Replication is an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">event emitter</a> like <a href="#changes">changes()</a> and emits the <code>'complete'</code>, <code>'active'</code>, <code>'paused'</code>, <code>'change'</code>, <code>'denied'</code> and <code>'error'</code> events.</p>

<h3 id="options-5">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>options.live</code>: If <code>true</code>, starts subscribing to future changes in the <code>source</code> database and continue replicating them.</li>
  <li><code>options.retry</code>: If <code>true</code> will attempt to retry replications in the case of failure (due to being offline), using a backoff algorithm that retries at longer and longer intervals until a connection is re-established. Only applicable if <code>options.live</code> is also <code>true</code>.</li>
</ul>

<p><strong>Filtering Options:</strong></p>

<ul>
  <li><code>options.filter</code>: Reference a filter function from a design document to selectively get updates. To use a view function, pass <code>_view</code> here and provide a reference to the view function in <code>options.view</code>. See <a href="#filtered-replication">filtered replication</a> for details.</li>
  <li><code>options.doc_ids</code>: Only show changes for docs with these ids (array of strings).</li>
  <li><code>options.query_params</code>: Object containing properties that are passed to the filter function, e.g. <code>{"foo:"bar"}</code>, where <code>"bar"</code> will be available in the filter function as <code>params.query.foo</code>. To access the <code>params</code>, define your filter function like <code>function (doc, params) {/* ... */}</code>.</li>
  <li><code>options.view</code>: Specify a view function (e.g. <code>'design_doc_name/view_name'</code>) to act as a filter. Documents counted as “passed” for a view filter if a map function emits at least one record for them. <strong>Note</strong>: <code>options.filter</code> must be set to <code>'_view'</code> for this option to work.</li>
</ul>

<p><strong>Advanced Options:</strong></p>

<ul>
  <li><code>options.since</code>: Replicate changes after the given sequence number.</li>
  <li><code>options.batch_size</code>: Number of documents to process at a time. Defaults to 100. This affects the number of docs held in memory and the number sent at a time to the target server. You may need to adjust downward if targeting devices with low amounts of memory (e.g. phones) or if the documents are large in size (e.g. with attachments). If your documents are small in size, then increasing this number will probably speed replication up.</li>
  <li><code>options.batches_limit</code>: Number of batches to process at a time. Defaults to 10. This (along wtih <code>batch_size</code>) controls how many docs are kept in memory at a time, so the maximum docs in memory at once would equal <code>batch_size</code> × <code>batches_limit</code>.</li>
  <li><code>options.back_off_function</code>: backoff function to be used in <code>retry</code> replication. This is a function that takes the current backoff as input (or 0 the first time) and returns a new backoff in milliseconds. You can use this to tweak when and how replication will try to reconnect to a remote database when the user goes offline. Defaults to a function that chooses a random backoff between 0 and 2 seconds and doubles every time it fails to connect. (See <a href="#customizing-retry-replication">Customizing retry replication</a> below.)</li>
</ul>

<h4 id="example-usage-9">Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">rep</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">live</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">retry</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle change</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;paused&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// replication paused (e.g. user went offline)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// replicate resumed (e.g. user went back online)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;denied&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// a document failed to replicate, e.g. due to permissions</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle complete</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle error</span>
<span class="p">});</span>

<span class="nx">rep</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></div>

<p>There are also shorthands for replication given existing PouchDB objects. These behave the same as <code>PouchDB.replicate()</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span>
<span class="c1">// or</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span></code></pre></div>

<p>The <code>remoteDB</code> can either be a string or a <code>PouchDB</code> object. If you have special ajax options on a remote database, you will want to use <code>PouchDB</code> objects instead of strings, so that the options are used.</p>

<h4 id="replication-events">Replication events</h4>

<ul>
  <li><strong><code>change</code></strong> (<code>info</code>) - This event fires when the replication has written a new document. <code>info</code> will contain details about the change. <code>info.doc</code> will contain the doc if you set <code>include_docs</code> to <code>true</code>. See below for an example response.</li>
  <li><strong><code>complete</code></strong> (<code>info</code>) - This event fires when replication is completed or cancelled. In a live replication, only cancelling the replication should trigger this event. <code>info</code> will contain details about the replication. See below for an example response.</li>
  <li><strong><code>paused</code></strong> (<code>err</code>) - This event fires when the replication is paused, either because a live replication is waiting for changes, or replication has temporarily failed, with <code>err</code>, and is attempting to resume.</li>
  <li><strong><code>active</code></strong> - This event fires when the replication starts actively processing changes; e.g. when it recovers from an error or new changes are available.</li>
  <li><strong><code>denied</code></strong> (<code>err</code>) - This event fires if a document failed to replicate due to validation or authorization errors.</li>
  <li><strong><code>error</code></strong> (<code>err</code>) - This event is fired when the replication is stopped due to an unrecoverable failure. If <code>retry</code> is <code>false</code>, this will also fire when the user goes offline or another network error occurs (so you can handle retries yourself, if you want).</li>
  <li><strong><code>uptodate</code></strong> (<em>deprecated</em>) - This event fires when a live replication has caught up and is waiting on future changes. This should be replaced by using the <code>paused</code> event.</li>
</ul>

<h4 id="single-shot-1">Single-shot</h4>

<p>As with <a href="#changes">changes()</a>, you can also omit <code>live</code>, in which case you can use <code>replicate()</code> in the callback/promise style and it will be treated as a single-shot operation.</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="replication1" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remote</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle &#39;completed&#39; result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="replication1" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remote</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle &#39;completed&#39; result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>For non-live replications, the returned object is also an event emitter as well as a promise, and you can use all the events described above (except for <code>'paused'</code> and <code>'active'</code>, which only apply to <code>retry</code> replications).</p>

<h4 id="example-response-9">Example Response:</h4>

<p>Example response in the <code>'change'</code> listener:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;doc_write_failures&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;docs_read&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;docs_written&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;errors&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;last_seq&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;start_time&quot;</span><span class="o">:</span> <span class="s2">&quot;Fri May 16 2014 18:23:12 GMT-0700 (PDT)&quot;</span>
<span class="p">}</span></code></pre></div>

<p>Example response in the <code>'complete'</code> listener:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;doc_write_failures&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;docs_read&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;docs_written&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;end_time&quot;</span><span class="o">:</span> <span class="s2">&quot;Fri May 16 2014 18:26:00 GMT-0700 (PDT)&quot;</span><span class="p">,</span>
  <span class="s2">&quot;errors&quot;</span><span class="o">:</span> <span class="p">[],</span>
  <span class="s2">&quot;last_seq&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;start_time&quot;</span><span class="o">:</span> <span class="s2">&quot;Fri May 16 2014 18:26:00 GMT-0700 (PDT)&quot;</span><span class="p">,</span>
  <span class="s2">&quot;status&quot;</span><span class="o">:</span> <span class="s2">&quot;complete&quot;</span>
<span class="p">}</span></code></pre></div>

<p>Note that replication is supported for both local and remote databases. So you can replicate from local to local or from remote to remote.</p>

<p>However, if you replicate from remote to remote, then the changes will flow through PouchDB. If you want to trigger a server-initiated replication, please use regular ajax to POST to the CouchDB <code>_replicate</code> endpoint, as described <a href="https://wiki.apache.org/couchdb/Replication">in the CouchDB docs</a>.</p>

<h4 id="filtered-replication">Filtered replication</h4>

<p>As with <a href="#changes">changes()</a>, you can filter from the source database using:</p>

<ul>
  <li>an ad-hoc <code>filter</code> function</li>
  <li>an array of <code>doc_ids</code></li>
  <li>a <code>filter</code> function inside of a design document</li>
  <li>a <code>filter</code> function inside of a design document, with <code>query_params</code></li>
  <li>a <code>view</code> function inside of a design document</li>
</ul>

<p>If you are replicating from a remote CouchDB, then the first method will run client-side, whereas the last four will filter on the server side. Therefore the last four should be preferred, especially if the database is large, because you want to send as few documents over the wire as possible.</p>

<p>You should also beware trying to use filtered replication to enforce security, e.g. to partition a database per user. A better strategy is the <a href="https://github.com/nolanlawson/pouchdb-authentication#couchdb-authentication-recipes">“one database per user” method</a>.</p>

<div class="alert alert-warning">


<div class="alert-text">



<p><strong>Deleting filtered docs</strong>: When you use filtered replication, you should avoid using <code>remove()</code> to delete documents, because that removes all their fields as well, which means they might not pass the filter function anymore, causing the deleted revision to not be replicated. Instead, set the <code>doc._deleted</code> flag to <code>true</code> and then use <code>put()</code> or <code>bulkDocs()</code>.</p>



</div></div>

<h4 id="filtering-examples-1">Filtering examples</h4>

<p>In these examples, we’ll work with some mammals. Let’s imagine our docs are:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="p">{</span><span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Kangaroo&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Koala&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Platypus&#39;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;monotreme&#39;</span><span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>Here are 5 examples using the 5 different systems.</p>

<p><strong>Example 1: Ad-hoc <code>filter</code> function</strong></p>

<p><em>Warning</em>: this runs client-side, if you are replicating from a remote database.</p>

<p>Filter by <code>type === 'marsupial'</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">filter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p><strong>Example 2: Array of <code>doc_ids</code></strong></p>

<p>Filter documents with <code>_id</code>s <code>['a', 'c']</code>.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">doc_ids</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="p">});</span></code></pre></div>

<p><strong>Example 3: <code>filter</code> function inside of a design document</strong></p>

<p>First <code>put()</code> a design document in the remote database:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;_design/mydesign&#39;</span><span class="p">,</span>
  <span class="nx">filters</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">myfilter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">filter</span><span class="o">:</span> <span class="s1">&#39;mydesign/myfilter&#39;</span>
<span class="p">});</span></code></pre></div>

<p><strong>Example 4: <code>filter</code> function inside of a design document, with <code>query_params</code></strong></p>

<p>This is the most powerful way to filter, because it allows you to pass in arbitrary options to your filter function.</p>

<p>First <code>put()</code> a design document in the remote database:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;_design/mydesign&#39;</span><span class="p">,</span>
  <span class="nx">filters</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">myfilter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">filter</span><span class="o">:</span> <span class="s1">&#39;mydesign/myfilter&#39;</span><span class="p">,</span>
  <span class="nx">query_params</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p><strong>Example 5: <code>view</code> function inside of a design document</strong></p>

<p>This doesn’t really offer any advantages compared to the previous two methods, unless you are already using a <code>view</code> for map/reduce queries, and you want to reuse it.</p>

<p>Any documents that <code>emit()</code> anything will be considered to have passed this filter method.</p>

<p>First <code>put()</code> a design document in the remote database:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;_design/mydesign&#39;</span><span class="p">,</span>
  <span class="nx">views</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">myview</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;marsupial&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">filter</span><span class="o">:</span> <span class="s1">&#39;_view&#39;</span><span class="p">,</span>
  <span class="nx">view</span><span class="o">:</span> <span class="s1">&#39;mydesign/myview&#39;</span>
<span class="p">});</span></code></pre></div>

<h4 id="customizing-retry-replication">Customizing retry replication</h4>

<p>During <code>retry</code> replication, you can customize the backoff function that determines how long to wait before reconnecting when the user goes offline.</p>

<p>Here’s a simple backoff function that starts at 1000 milliseconds and triples it every time a remote request fails:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remote</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">live</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">retry</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">back_off_function</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">delay</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">delay</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<p>The first time a request fails, this function will receive 0 as input. The next time it fails, 1000 will be passed in, then 3000, then 9000, etc. When the user comes back online, the <code>delay</code> goes back to 0.</p>

<p>By default, PouchDB uses a backoff function that chooses a random starting number between 0 and 2000 milliseconds and will roughly double every time, with some randommness to prevent client requests from occurring simultaneously.</p>

<div id="sync"></div>
<p><a class="h2 anchor" href="#sync" name="sync">Sync a database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">sync</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></div>

<p>Sync data from <code>src</code> to <code>target</code> and <code>target</code> to <code>src</code>. This is a convenience method for bidirectional data replication.</p>

<p>In other words, this code:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">);</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;mydb&#39;</span><span class="p">);</span></code></pre></div>

<p>is equivalent to this code:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">);</span></code></pre></div>

<h3 id="options-6">Options</h3>

<p>Please refer to <a href="api.html#replication">replicate()</a> for documentation on options, as <code>sync()</code> is just a convenience method that entails bidirectional replication.</p>

<h4 id="example-usage-10">Example Usage:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">sync</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">live</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">retry</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle change</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;paused&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// replication paused (e.g. user went offline)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// replicate resumed (e.g. user went back online)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;denied&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// a document failed to replicate, e.g. due to permissions</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle complete</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle error</span>
<span class="p">});</span>

<span class="nx">sync</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></div>

<p>There is also a shorthand for syncing given existing PouchDB objects. This behaves the same as <code>PouchDB.sync()</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span></code></pre></div>

<p>For any further details, please refer to <a href="api.html#replication">replicate()</a>.</p>

<div id="save_attachment"></div>
<p><a class="h2 anchor" href="#save_attachment" name="save_attachment">Save an attachment</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="p">[</span><span class="nx">rev</span><span class="p">],</span> <span class="nx">attachment</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">]);</span></code></pre></div>

<p>Attaches a binary object to a document.</p>

<p>This method will update an existing document to add the attachment, so it requires a <code>rev</code> if the document already exists. If the document doesn’t already exist, then this method will create an empty document containing the attachment.</p>

<p>What’s the point of attachments? If you’re dealing with large binary data (such as PNGs), you may incur a performance or storage penalty if you naïvely include them as base64- or hex-encoded strings inside your documents. But if you insert the binary data as an attachment, then PouchDB will attempt to store it in <a href="http://pouchdb.com/faq.html#data_types">the most efficient way possible</a>.</p>

<p>For details, see the <a href="https://wiki.apache.org/couchdb/HTTP_Document_API#Attachments">CouchDB documentation on attachments</a>.</p>

<h4 id="example-usage-11">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="attach1" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">&#39;Is there life on Mars?&#39;</span><span class="p">]);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="attach1" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">&#39;Is there life on Mars?&#39;</span><span class="p">]);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-10">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;2-068E73F5B44FEC987B51354DFC772891&quot;</span>
<span class="p">}</span></code></pre></div>

<p>Within Node, you must use a <code>Buffer</code> instead of a <code>Blob</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;Is there life on Mars?&#39;</span><span class="p">);</span></code></pre></div>

<p>For details, see the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Mozilla docs on <code>Blob</code></a> or the <a href="http://nodejs.org/api/buffer.html">Node docs on <code>Buffer</code></a>.</p>

<p>If you need a shim for older browsers that don’t support the <code>Blob</code> constructor, or you want some convenience methods for Blobs, you can use <a href="https://github.com/nolanlawson/blob-util">blob-util</a>.</p>

<h4 id="save-a-base64-attachment">Save a base64 attachment</h4>

<p>If you supply a string instead of a <code>Blob</code>/<code>Buffer</code>, then it will be assumed to be a base64-encoded string, and will be processed accordingly:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="attach3" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> 
        <span class="s2">&quot;TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS&quot;</span> <span class="o">+</span>
        <span class="s2">&quot;BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA==&quot;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="attach3" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> 
        <span class="s2">&quot;TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS&quot;</span> <span class="o">+</span>
        <span class="s2">&quot;BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA==&quot;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="save-an-inline-attachment">Save an inline attachment</h4>

<p>You can also inline attachments inside the document. The attachment data may be supplied as a base64-encoded string with the <code>content_type</code>:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="attach2" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Legendary Hearts&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;att.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS&quot;</span> <span class="o">+</span>
              <span class="s2">&quot;BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA==&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="attach2" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Legendary Hearts&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;att.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS&quot;</span> <span class="o">+</span>
              <span class="s2">&quot;BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA==&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="save-an-inline-blobbuffer-attachment">Save an inline Blob/Buffer attachment</h4>

<p>You can also inline <code>Blob</code>s/<code>Buffer</code>s:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="attach4" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Legendary Hearts&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;att.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">&#39;Is there life on Mars?&#39;</span><span class="p">])</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="attach4" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Legendary Hearts&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;att.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">&#39;Is there life on Mars?&#39;</span><span class="p">])</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="save-many-attachments-at-once">Save many attachments at once</h4>

<p>The inline approach allows you to save multiple attachments to the same document in a single shot:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="attach5" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Legendary Hearts&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;att.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s2">&quot;And she&#39;s hooked to the silver screen&quot;</span><span class="p">])</span>
      <span class="p">},</span>
      <span class="s2">&quot;att2.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s2">&quot;But the film is a saddening bore&quot;</span><span class="p">])</span>
      <span class="p">},</span>
      <span class="s2">&quot;att3.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s2">&quot;For she&#39;s lived it ten times or more&quot;</span><span class="p">])</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="attach5" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Legendary Hearts&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;att.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s2">&quot;And she&#39;s hooked to the silver screen&quot;</span><span class="p">])</span>
    <span class="p">},</span>
    <span class="s2">&quot;att2.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s2">&quot;But the film is a saddening bore&quot;</span><span class="p">])</span>
    <span class="p">},</span>
    <span class="s2">&quot;att3.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s2">&quot;For she&#39;s lived it ten times or more&quot;</span><span class="p">])</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>See <a href="http://wiki.apache.org/couchdb/HTTP_Document_API#Inline_Attachments">Inline Attachments</a>
on the CouchDB wiki for details.</p>

<div id="get_attachment"></div>
<p><a class="h2 anchor" href="#get_attachment" name="get_attachment">Get an attachment</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Get attachment data.</p>

<h3 id="options-7">Options</h3>

<ul>
  <li><code>options.rev</code>: as with <a href="#fetch_document">get()</a>, you can pass a <code>rev</code> in and get back an attachment for the document at that particular revision.</li>
</ul>

<h4 id="example-usage-12">Example Usage:</h4>

<p>Get an attachment with filename <code>'att.txt'</code> from document with ID <code>'doc'</code>:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="get_att1" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">blobOrBuffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="get_att1" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">blobOrBuffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>Get an attachment with filename <code>'att.txt'</code> from document with ID <code>'doc'</code>, at
the revision <code>'1-abcd'</code>:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="get_att2" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">rev</span><span class="o">:</span> <span class="s1">&#39;1-abcd&#39;</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">blobOrBuffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="get_att2" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">rev</span><span class="o">:</span> <span class="s1">&#39;1-abcd&#39;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">blobOrBuffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="response-type">Response type:</h4>

<p>The response will be a <code>Blob</code> object in the browser, and a <code>Buffer</code> object in Node.js. See <a href="https://github.com/nolanlawson/blob-util">blob-util</a> for utilities to transform <code>Blob</code>s to other formats, such as base64-encoded strings, data URLs, array buffers, etc.</p>

<h4 id="inline-base64-attachments">Inline base64 attachments</h4>

<p>You can specify <code>{attachments: true}</code> to most “read” operations, such as <code>get()</code>, <code>allDocs()</code>, <code>changes()</code>, and <code>query()</code>. The attachment data will then be included inlined in the resulting doc(s). However, it will always be supplied as base64. For example:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;att.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;digest&quot;</span><span class="o">:</span> <span class="s2">&quot;d5ccfd24a8748bed4e2c9a279a2b6089&quot;</span><span class="p">,</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;SXMgdGhlcmUgbGlmZSBvbiBNYXJzPw==&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-e147d9ec9c85139dfe7e93bc17148d1a&quot;</span>
<span class="p">}</span></code></pre></div>

<p>For such APIs, when you don’t specify <code>{attachments: true}</code>, you will instead get metadata about the attachments. For example:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;att.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;digest&quot;</span><span class="o">:</span> <span class="s2">&quot;d5ccfd24a8748bed4e2c9a279a2b6089&quot;</span><span class="p">,</span>
      <span class="s2">&quot;stub&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-e147d9ec9c85139dfe7e93bc17148d1a&quot;</span>
<span class="p">}</span></code></pre></div>

<p>This “summary” operation may be faster in some cases, because the attachment itself does not need to be read from disk.</p>

<div id="delete_attachment"></div>
<p><a class="h2 anchor" href="#delete_attachment" name="delete_attachment">Delete an attachment</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="nx">rev</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Delete an attachment from a doc. You must supply the <code>rev</code> of the existing doc.</p>

<h4 id="example-usage-13">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="delete_att" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">rev</span> <span class="o">=</span> <span class="s1">&#39;1-068E73F5B44FEC987B51354DFC772891&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="nx">rev</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result                      </span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="delete_att" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">rev</span> <span class="o">=</span> <span class="s1">&#39;1-068E73F5B44FEC987B51354DFC772891&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;att.txt&#39;</span><span class="p">,</span> <span class="nx">rev</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-11">Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;2-1F983211AB87EFCCC980974DFC27382F&quot;</span>
<span class="p">}</span></code></pre></div>

<div id="query_database"></div>
<p><a class="h2 anchor" href="#query_database" name="query_database">Query the database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Invoke a map/reduce function, which allows you to perform more complex queries on PouchDB than what you get with <a href="#batch_fetch">allDocs()</a>. The <a href="http://docs.couchdb.org/en/latest/couchapp/views/intro.html">CouchDB documentation for map/reduce</a> applies to PouchDB.</p>

<p>Since views perform a full scan of all documents, this method may be slow, unless you first save your view in a design document. Read the <a href="/guides/queries.html">query guide</a> for a good tutorial.</p>

<div class="alert alert-info">


<div class="alert-text">



<p><strong>Heads up:</strong> eventually the <code>query()</code> API will be deprecated in favor of the much simpler  <a href="https://github.com/nolanlawson/pouchdb-find">pouchdb-find plugin</a>. You will still be able to use <code>query()</code>, but it will be distributed as <a href="https://github.com/pouchdb/mapreduce">a separate plugin</a>.</p>



</div></div>

<h3 id="options-8">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>fun</code>: Map/reduce function, which can be one of the following:
    <ul>
      <li>A full CouchDB-style map/reduce view: <code>{map : ..., reduce: ...}</code>.</li>
      <li>A map function by itself (no reduce).</li>
      <li>The name of a view in an existing design document (e.g. <code>'mydesigndoc/myview'</code>, or <code>'myview'</code> as a shorthand for <code>'myview/myview'</code>).</li>
    </ul>
  </li>
  <li><code>options.reduce</code>: Reduce function, or the string name of a built-in function: <code>'_sum'</code>, <code>'_count'</code>, or <code>'_stats'</code>.  Defaults to <code>false</code> (no reduce).
    <ul>
      <li>Tip: if you’re not using a built-in, <a href="http://youtu.be/BKQ9kXKoHS8?t=865s">you’re probably doing it wrong</a>.</li>
      <li>PouchDB will always call your reduce function with rereduce == false. As for CouchDB, refer to the <a href="http://docs.couchdb.org/en/1.6.1/couchapp/views/intro.html">CouchDB documentation</a>.</li>
    </ul>
  </li>
  <li><code>options.include_docs</code>: Include the document in each row in the <code>doc</code> field.
    <ul>
      <li><code>options.conflicts</code>: Include conflicts in the <code>_conflicts</code> field of a doc.</li>
      <li><code>options.attachments</code>: Include attachment data.</li>
    </ul>
  </li>
  <li><code>options.startkey</code> &amp; <code>options.endkey</code>: Get rows with keys in a certain range (inclusive/inclusive).</li>
  <li><code>options.inclusive_end</code>: Include rows having a key equal to the given <code>options.endkey</code>. Default: <code>true</code>.</li>
  <li><code>options.limit</code>: Maximum number of rows to return.</li>
  <li><code>options.skip</code>: Number of rows to skip before returning (warning: poor performance on IndexedDB/LevelDB!).</li>
  <li><code>options.descending</code>: Reverse the order of the output rows.</li>
  <li><code>options.key</code>: Only return rows matching this key.</li>
  <li><code>options.keys</code>: Array of keys to fetch in a single shot.
    <ul>
      <li>Neither <code>startkey</code> nor <code>endkey</code> can be specified with this option.</li>
      <li>The rows are returned in the same order as the supplied <code>keys</code> array.</li>
      <li>The row for a deleted document will have the revision ID of the deletion, and an extra key <code>"deleted":true</code> in the <code>value</code> property.</li>
      <li>The row for a nonexistent document will just contain an <code>"error"</code> property with the value <code>"not_found"</code>.</li>
    </ul>
  </li>
  <li><code>options.group</code>: True if you want the reduce function to group results by keys, rather than returning a single result. Defaults to <code>false</code>.</li>
  <li><code>options.group_level</code>: Number of elements in a key to group by, assuming the keys are arrays. Defaults to the full length of the array.</li>
  <li><code>options.stale</code>: One of <code>'ok'</code> or <code>'update_after'</code>.  Only applies to saved views. Can be one of:
    <ul>
      <li>unspecified (default): Returns the latest results, waiting for the view to build if necessary.</li>
      <li><code>'ok'</code>: Returns results immediately, even if they’re out-of-date.</li>
      <li><code>'update_after'</code>: Returns results immediately, but kicks off a build afterwards.</li>
    </ul>
  </li>
</ul>

<p>For details, see the <a href="http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options">CouchDB query options documentation</a>.</p>

<h4 id="example-usage-14">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="query1" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// create a design doc</span>
<span class="kd">var</span> <span class="nx">ddoc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;_design/index&#39;</span><span class="p">,</span>
  <span class="nx">views</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">map</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">mapFun</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// save the design doc</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">ddoc</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">409</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// ignore if doc already exists</span>
  <span class="c1">// find docs where title === &#39;Lisa Says&#39;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span>
    <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle result</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="query1" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// create a design doc</span>
<span class="kd">var</span> <span class="nx">ddoc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;_design/index&#39;</span><span class="p">,</span>
  <span class="nx">views</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">map</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">mapFun</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// save the design doc</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">ddoc</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">409</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// ignore if doc already exists</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// find docs where title === &#39;Lisa Says&#39;</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span>
    <span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">});</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-12">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;offset&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Lisa Says&quot;</span><span class="p">,</span>
    <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc3&quot;</span><span class="p">,</span>
      <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-z&quot;</span><span class="p">,</span>
      <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Lisa Says&quot;</span>
    <span class="p">}</span>
  <span class="p">}],</span>
  <span class="s2">&quot;total_rows&quot;</span> <span class="o">:</span> <span class="mi">4</span>
<span class="p">}</span></code></pre></div>

<p>In the result,<code>total_rows</code> is the total number of possible results in the view. The response is very similar to that of <code>allDocs()</code>.</p>

<p><strong>Note:</strong> you can also pass in the map function instead of saving a design doc first, but this is slow because it has to do a full database scan. The following examples will use this pattern for simplicity’s sake, but you should normally avoid it.</p>

<h4 id="complex-keys">Complex keys</h4>

<p>You can also use <a href="https://wiki.apache.org/couchdb/Introduction_to_CouchDB_views#Complex_Keys">complex keys</a> for fancy ordering:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="query2" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// sort by last name, first name, and age</span>
  <span class="nx">emit</span><span class="p">([</span><span class="nx">doc</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">age</span><span class="p">]);</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="query2" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// sort by last name, first name, and age</span>
  <span class="nx">emit</span><span class="p">([</span><span class="nx">doc</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">age</span><span class="p">]);</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-13">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Bowie&quot;</span><span class="p">,</span> <span class="s2">&quot;David&quot;</span><span class="p">,</span> <span class="mi">67</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;dylan&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Dylan&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="mi">72</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;younger_dylan&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Dylan&quot;</span><span class="p">,</span> <span class="s2">&quot;Jakob&quot;</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;hank_the_third&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Williams&quot;</span><span class="p">,</span> <span class="s2">&quot;Hank&quot;</span><span class="p">,</span> <span class="mi">41</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;hank&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Williams&quot;</span><span class="p">,</span> <span class="s2">&quot;Hank&quot;</span><span class="p">,</span> <span class="mi">91</span><span class="p">]</span>
    <span class="p">}],</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">5</span>
<span class="p">}</span></code></pre></div>

<p><strong>Tips:</strong></p>

<ul>
  <li>The sort order is <code>[nulls, booleans, numbers, strings, arrays, objects]</code>, so <code>{startkey: ['Williams'], endkey: ['Williams', {}]}</code> would return all people with the last name <code>'Williams'</code> because objects are higher than strings. Something like <code>'zzzzz'</code> or <code>'\uffff'</code> would also work.</li>
  <li><code>group_level</code> can be very helpful when working with complex keys.  In the example above, you can use <code>{group_level: 1}</code> to group by last name, or <code>{group_level: 2}</code> to group by last and first name. (Be sure to set <code>{reduce: true, group: true}</code> as well.)</li>
</ul>

<h4 id="linked-documents">Linked documents</h4>

<p>PouchDB fully supports <a href="https://wiki.apache.org/couchdb/Introduction_to_CouchDB_views#Linked_documents">linked documents</a>. Use them to join two types of documents together, by simply adding an <code>_id</code> to the emitted value:</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="query3" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// join artist data to albums</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;album&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">artistId</span><span class="p">,</span> <span class="nx">albumYear</span> <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">year</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="p">{</span><span class="nx">include_docs</span> <span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="query3" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// join artist data to albums</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;album&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">artistId</span><span class="p">,</span> <span class="nx">albumYear</span> <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">year</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="p">{</span><span class="nx">include_docs</span> <span class="o">:</span> <span class="kc">true</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-14">Example response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-fdb234b78904a5c8293f2acf4be70d44&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">&quot;firstName&quot;</span><span class="o">:</span> <span class="s2">&quot;David&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lastName&quot;</span><span class="o">:</span> <span class="s2">&quot;Bowie&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_hunkeydory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Hunky Dory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;albumYear&quot;</span><span class="o">:</span> <span class="mi">1971</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-fdb234b78904a5c8293f2acf4be70d44&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">&quot;firstName&quot;</span><span class="o">:</span> <span class="s2">&quot;David&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lastName&quot;</span><span class="o">:</span> <span class="s2">&quot;Bowie&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_low&quot;</span><span class="p">,</span>
            <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Low&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;albumYear&quot;</span><span class="o">:</span> <span class="mi">1977</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-fdb234b78904a5c8293f2acf4be70d44&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">&quot;firstName&quot;</span><span class="o">:</span> <span class="s2">&quot;David&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lastName&quot;</span><span class="o">:</span> <span class="s2">&quot;Bowie&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_spaceoddity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Space Oddity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;albumYear&quot;</span><span class="o">:</span> <span class="mi">1969</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">}</span></code></pre></div>

<h4 id="closures">Closures</h4>

<p>If you pass a function to <code>db.query</code> and give it the <code>emit</code> function as the second argument, then you can use a closure. (Since PouchDB has to use <code>eval()</code> to bind <code>emit</code>.)</p>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="query4" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// BAD! will throw error</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// you&#39;ll get an error here</span>
<span class="p">});</span>

<span class="c1">// will be fine</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="query4" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// BAD! will throw error</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// you&#39;ll get an error here</span>
<span class="p">}</span>

<span class="c1">// will be fine</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<p>Note that closures are only supported by local databases with temporary views. So if you are using closures, then you must use the slower method that requires a full database scan.</p>

<div id="view_cleanup"></div>
<p><a class="h2 anchor" href="#view_cleanup" name="view_cleanup">View cleanup</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">([</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Cleans up any stale map/reduce indexes.</p>

<p>As design docs are deleted or modified, their associated index files (in CouchDB) or companion databases (in local PouchDBs) continue to take up space on disk. <code>viewCleanup()</code> removes these unnecessary index files.</p>

<p>See <a href="http://couchdb.readthedocs.org/en/latest/maintenance/compaction.html#views-cleanup">the CouchDB documentation on view cleanup</a> for details.</p>

<h4 id="example-usage-15">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="viewcleanup" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="viewcleanup" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-15">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="s2">&quot;true&quot;</span> <span class="p">}</span></code></pre></div>

<div id="database_information"></div>
<p><a class="h2 anchor" href="#database_information" name="database_information">Get database information</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">([</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Get information about a database.</p>

<h4 id="example-usage-16">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="dbinfo" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="dbinfo" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-16">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;db_name&quot;</span><span class="o">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
  <span class="s2">&quot;doc_count&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s2">&quot;update_seq&quot;</span><span class="o">:</span> <span class="mi">5</span>
<span class="p">}</span></code></pre></div>

<p><strong>Response object:</strong></p>

<ul>
  <li><code>db_name</code> is the name of the database you gave when you called <code>new PouchDB()</code>, and also the unique identifier for the database.</li>
  <li><code>doc_count</code> is the total number of non-deleted documents in the database.</li>
  <li><code>update_seq</code> is the sequence number of the database.  It starts at 0 and gets incremented every time a document is added or modified.</li>
</ul>

<p>There are also some details you can use for debugging. These are unofficial and may change at any time:</p>

<ul>
  <li><code>idb_attachment_format</code>: (IndexedDB) either <code>'base64'</code> or <code>'binary'</code>, depending on whether the browser <a href="/faq.html#data_types">supports binary blobs</a>.</li>
  <li><code>sqlite_plugin</code>: (WebSQL) true if the <a href="https://github.com/brodysoft/Cordova-SQLitePlugin">SQLite Plugin</a> is being used.</li>
  <li><code>websql_encoding</code>: (WebSQL) either <code>'UTF-8'</code> or <code>'UTF-16'</code>, depending on the <a href="http://pouchdb.com/faq.html#data_types">WebSQL implementation</a></li>
</ul>

<div id="compaction"></div>
<p><a class="h2 anchor" href="#compaction" name="compaction">Compact the database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">compact</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Triggers a compaction operation in the local or remote database. This reduces the database’s size by removing unused and old data, namely non-leaf revisions and attachments that are no longer referenced by those revisions. Note that this is a separate operation from <a href="#view_cleanup"><code>viewCleanup()</code></a>.</p>

<p>For remote databases, PouchDB checks the compaction status at regular intervals and fires the callback (or resolves the promise) upon completion. Consult the <a href="http://couchdb.readthedocs.org/en/latest/maintenance/compaction.html">compaction section of CouchDB’s maintenance documentation</a> for more details.</p>

<p>Also see <a href="#create_database">auto-compaction</a>, which runs compaction automatically (local databases only).</p>

<ul>
  <li><code>options.interval</code>: Number of milliseconds to wait before asking again if compaction is already done. Defaults to 200. (Only applies to remote databases.)</li>
</ul>

<h4 id="example-usage-17">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="compact" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">compact</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="compact" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">compact</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-17">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="s2">&quot;true&quot;</span> <span class="p">}</span></code></pre></div>

<div id="revisions_diff"></div>
<p><a class="h2 anchor" href="#revisions_diff" name="revisions_diff">Document revisions diff</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">(</span><span class="nx">diff</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Given a set of document/revision IDs, returns the subset of those that do not correspond
to revisions stored in the database. Primarily used in replication.</p>

<h4 id="example-usage-18">Example Usage:</h4>

<p><strong data-code-hide="">Callback:</strong></p>

<div class="tab-pane " id="callback" data-code-id="revsdiff1" data-code-type="callback">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">({</span>
  <span class="nx">myDoc1</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;1-b2e54331db828310f3c772d6e042ac9c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2-3a24009a9525bde9e4bfa8a99046b00d&quot;</span>
  <span class="p">]</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></div>
</div>

<p><strong data-code-hide="">Promise:</strong></p>

<div class="tab-pane active" id="promise" data-code-id="revsdiff1" data-code-type="promise">

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">({</span>
  <span class="nx">myDoc1</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;1-b2e54331db828310f3c772d6e042ac9c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2-3a24009a9525bde9e4bfa8a99046b00d&quot;</span>
  <span class="p">]</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>
</div>

<h4 id="example-response-18">Example Response:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;myDoc1&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;missing&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;2-3a24009a9525bde9e4bfa8a99046b00d&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<div id="events"></div>
<p><a class="h2 anchor" href="#events" name="events">Events</a></p>

<p>PouchDB is an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">event emitter</a> and will emit a <code>'created'</code> event when a database is created. A <code>'destroyed'</code> event is emitted when a database is destroyed.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dbName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called whenver a db is created.</span>
<span class="p">});</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;destroyed&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dbName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called whenver a db is destroyed.</span>
<span class="p">});</span></code></pre></div>

<div id="defaults"></div>
<p><a class="h2 anchor" href="#defaults" name="defaults">Default settings</a></p>

<p>If you find yourself using the same constructor options repeatedly,
you can simplify your code with <code>PouchDB.defaults()</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="nx">option1</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
  <span class="nx">option2</span><span class="o">:</span> <span class="s1">&#39;value&#39;</span>
<span class="p">});</span></code></pre></div>

<p>The returned object is a constructor function that works the same as <code>PouchDB</code>, except that whenever you invoke it (e.g. with <code>new</code>), the given options will be passed in by default.</p>

<h4 id="example-usage-19">Example Usage:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">MyMemPouch</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="nx">db</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;memdown&#39;</span><span class="p">)</span>
<span class="p">});</span>
<span class="c1">// MemDOWN-backed Pouch (in Node)</span>
<span class="kd">var</span> <span class="nx">MyMemPouch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyMemPouch</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MyPrefixedPouch</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="nx">prefix</span><span class="o">:</span> <span class="s1">&#39;/path/to/my/db/&#39;</span>
<span class="p">});</span>
<span class="c1">// db will be named &#39;/path/to/my/db/dbname&#39;, useful for LevelDB</span>
<span class="kd">var</span> <span class="nx">myPrefixedPouch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyPrefixedPouch</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">);</span></code></pre></div>

<p>Note the special constructor option <code>prefix</code>, which appends a prefix to the database name
and can be helpful for URL-based or file-based LevelDOWN path names.</p>

<p>All <a href="#create_database">constructor options</a> are supported. Default options can still be overriden individually.</p>

<div id="plugins"></div>
<p><a class="h2 anchor" href="#plugins" name="plugins">Plugins</a></p>

<p>Writing a plugin is easy! The API is:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">plugin</span><span class="p">({</span>
  <span class="nx">methodName</span><span class="o">:</span> <span class="nx">myFunction</span>
<span class="p">});</span></code></pre></div>

<p>This will add a <code>db.methodName()</code> to all databases, which runs <code>myFunction</code>.It will always be called in context, so that within the function, <code>this</code> refers to the database object.</p>

<p>There is a <a href="https://github.com/pouchdb/plugin-seed">PouchDB Plugin Seed project</a>, which is the fastest way to get started writing, building and testing your very own plugin.</p>

<h4 id="example-usage-20">Example Usage:</h4>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">plugin</span><span class="p">({</span>
  <span class="nx">sayHello</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hello!&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">).</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// prints &quot;Hello!&quot;</span></code></pre></div>

<div id="extras"></div>
<p><a class="h2 anchor" href="#extras" name="extras">Extras</a></p>

<p>PouchDB offers some “extra” APIs that are designed for PouchDB plugin authors, or for those who want to use non-standard adapters like in-memory and LocalStorage.</p>

<p>These can be especially useful when you are using <a href="http://browserify.org/">Browserify</a>/<a href="https://github.com/webpack/webpack">Webpack</a>, because they can reduce your overall code size by deduplicating packages. If you’re not using Browserify/Webpack, you can also download them <a href="/adapters.html#pouchdb_in_the_browser">as standalone scripts</a>.</p>

<h3 id="browser-adapter-plugins">Browser adapter plugins</h3>

<p>These adapters are alternatives to PouchDB’s built-in IndexedDB/WebSQL adapters. They fully pass the PouchDB test suite.</p>

<h4 id="localstorage-adapter">LocalStorage adapter</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">PouchDB</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb&#39;</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb/extras/localstorage&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">adapter</span><span class="o">:</span> <span class="s1">&#39;localstorage&#39;</span><span class="p">});</span></code></pre></div>

<p>PouchDB adapter using <a href="http://www.w3.org/TR/webstorage/">LocalStorage</a>. Intended for browsers and environments that don’t support IndexedDB or WebSQL. Based on <a href="https://github.com/No9/localstorage-down">localstorage-down</a>.</p>

<p>You can also download this plugin <a href="https://github.com/pouchdb/pouchdb/releases/download/3.5.0/pouchdb.localstorage.js">as a standalone script</a>.</p>

<h4 id="in-memory-adapter">In-memory adapter</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">PouchDB</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb&#39;</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb/extras/memory&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">adapter</span><span class="o">:</span> <span class="s1">&#39;memory&#39;</span><span class="p">});</span></code></pre></div>

<p>Fully in-memory PouchDB adapter. Data will not be saved after a browser refresh!</p>

<p>This adapter can be useful for unit tests or for environments that don’t support IndexedDB/WebSQL. Based on <a href="https://github.com/Level/memdown">MemDOWN</a>.</p>

<p>You can also download this plugin <a href="https://github.com/pouchdb/pouchdb/releases/download/3.5.0/pouchdb.memory.js">as a standalone script</a>.</p>

<div class="alert alert-warning">


<div class="alert-text">


<p>If you want to use an in-memory PouchDB in Node.js/io.js, you should <a href="/adapters.html#pouchdb_in_node_js">directly require MemDOWN instead</a>.</p>


</div></div>

<h4 id="alternative-indexeddb-adapter">Alternative IndexedDB adapter</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">PouchDB</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb&#39;</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb/extras/idb-alt&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">adapter</span><span class="o">:</span> <span class="s1">&#39;idb-alt&#39;</span><span class="p">});</span></code></pre></div>

<p>PouchDB adapter using <a href="https://github.com/maxogden/level.js">level-js</a> over IndexedDB as a storage backend. Mostly only interesting to PouchDB developers; someday, this may replace the standard IndexedDB adapter.</p>

<p>You can also download this plugin <a href="https://github.com/pouchdb/pouchdb/releases/download/3.5.0/pouchdb.idb-alt.js">as a standalone script</a>.</p>

<div class="alert alert-info">


<div class="alert-text">


<p>When you include these plugins in your project, they will be automatically picked up as a “third” option when you create a new PouchDB without an adapter specified (e.g. <code>new PouchDB('mydb')</code>).</p>

<p>So for instance, if the user loads PouchDB in a browser that does not support WebSQL or IndexedDB, and if you are using the in-memory plugin, then PouchDB will automatically use the memory adapter instead of WebSQL or IndexedDB.</p>


</div></div>

<h3 id="apis-for-plugin-authors">APIs for plugin authors</h3>

<p>These APIs are designed for PouchDB plugin authors, who may want to re-use some PouchDB code to avoid duplication.</p>

<p>To use these APIs, you should save PouchDB as a required npm dependency (<code>npm install --save pouchdb</code>) and then require them like so:</p>

<h4 id="ajax">Ajax</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">ajax</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb/extras/ajax&#39;</span><span class="p">);</span></code></pre></div>

<p>The <code>ajax()</code> function as used by PouchDB. Essentially a shim in the style of <code>jQuery.ajax</code>.</p>

<h4 id="checkpointer">Checkpointer</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Checkpointer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb/extras/checkpointer&#39;</span><span class="p">);</span></code></pre></div>

<p>The <code>Checkpointer</code> function as used by PouchDB’s replicator. Writes checkpoints as <code>_local</code> docs so that replication can resume where it last left off.</p>

<h4 id="promise">Promise</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">Promise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pouchdb/extras/promise&#39;</span><span class="p">);</span></code></pre></div>

<p>The ES6 <code>Promise</code> shim as used by PouchDB. Expect this to be <code>bluebird</code> in Node, <code>lie</code> in browsers without Promise support, and the global <code>Promise</code> in browsers with Promise support.</p>

<h4 id="caveats">Caveats</h4>

<p>These APIs are not rigorously documented and may change frequently. Refer to the <a href="https://github.com/pouchdb/pouchdb/tree/master/extras">source code</a> for the details of the APIs.</p>

<p>If your plugin depends on a particular version of PouchDB, please notify your users. Unless you like to live dangerously, you should also nail down the version of PouchDB you are using in your <code>package.json</code>. And if you need any other internal modules, please submit a pull request!</p>

<div id="debug_mode"></div>
<p><a class="h2 anchor" href="#debug_mode" name="debug_mode">Debug mode</a></p>

<p>PouchDB uses the <a href="https://www.npmjs.org/package/debug">debug</a> module for fine-grained debug output.</p>

<p>To enable debug mode, just call:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">);</span></code></pre></div>

<p>In your browser console, you should then see something like this:</p>

<p><a href="/static/img/debug_mode.png" target="_blank">
  <img class="img-responsive" src="/static/img/debug_mode.png" alt="Coloured Log Output" />
</a></p>

<p>In Node.js, you can also set a command-line flag:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">DEBUG</span><span class="o">=</span>pouchdb:* node myscript.js</code></pre></div>

<p>You can also enable debugging of specific modules. Currently we only have <code>pouchb:api</code> (API-level calls) and <code>pouchdb:http</code>  (HTTP requests):</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s1">&#39;pouchdb:api&#39;</span><span class="p">);</span> <span class="c1">// or</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s1">&#39;pouchdb:http&#39;</span><span class="p">);</span></code></pre></div>

<p>These settings are saved to the browser’s LocalStorage. So to disable them, you must call:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">disable</span><span class="p">();</span></code></pre></div>

<p>Your users won’t see debug output unless you explicitly call <code>PouchDB.debug.enable()</code> within your application code.</p>



        <div>

    </div>

  </div>

</article>


    <div class="icons">

      <div class="container">

        <div class="row">

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://twitter.com/pouchdb' target='_blank'>
              <div class="icon icon-twitter"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/rvagg/node-levelup' target='_blank'>
              <div class="icon icon-leveldb"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-github"></div>
            </a>
            </div>

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://travis-ci.org/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-travis"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='http://couchdb.apache.org/' target='_blank'>
              <div class="icon icon-couchdb"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://saucelabs.com' target='_blank'>
              <div class="icon icon-saucelabs"></div>
            </a>
          </div>

        </div>

      </div>

    </div>

    <footer class="footer">

      <div class="container">

        <div class="row">

          <div class='col-sm-3'>
            <h3 class="nav-head">Learn</h3>
            <ul class='nav nav-silent'>
              <li><a href="/getting-started.html">Getting Started</a></li>
              <li><a href="/api.html">API Guide</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/wiki">Wiki</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Discuss</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://groups.google.com/forum/#!forum/pouchdb">Mailing List</a></li>
              <li><a href="irc://freenode.net/#pouchdb">IRC</a></li>
              <li><a href="http://twitter.com/pouchdb">Twitter</a></li>
              <li><a href="http://stackoverflow.com/questions/tagged/pouchdb">StackOverflow</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Contribute</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/CONTRIBUTING.md">Contributing</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb">Source</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/issues">Issues</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/LICENSE">Apache License</a></li>
            </ul>
          </div>

        </div>

      </div>

    </footer>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/code.min.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/pouchdb/latest/pouchdb.min.js"></script>
    <script type="text/javascript">
      function onCached(e) {
        if (applicationCache.status === 1) {
          giveIntro();
        }
      }
      
      function giveIntro() {
        console.log('%c\n..............................................................................\n.?I...........~+: ............................................................\n.???.........++++.............................................................\n:????+......+++++.............................................................\n.??????+++++++++:.................................H...........D..B............\n...????++++++++...................................H...........D..B............\n...=????++++++.......PPPPP...OOOO...U....U...CCCC.HHHHH...DDDDD..BBBBB........\n...?????+++++++......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n..???????+++++++ ....P. ..P.O....O..U....U.CC.....H...H..D....D..B....B.......\n..?????????????......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n...I??????????~......PPPPP...OOOO...=UUUUU...CCCC.H...H...DDDDD..BBBBB........\n....?????????~.......P.... ...................................................\n.....???????+........P........................................................\n......??????..................................................................\n..............................................................................\n..............................................................................\n..............................................................................', 'color: #4ec084');
        console.log('%c\nPouchDB itself is hosted at PouchDB.com!\nTo get started, try typing:\nvar db = new PouchDB(\'mydb\');', 'color: #4ec084');
      }
      applicationCache.addEventListener('cached', onCached, false);
      applicationCache.addEventListener('noupdate', giveIntro, false);
    </script>
  </body>
</html>

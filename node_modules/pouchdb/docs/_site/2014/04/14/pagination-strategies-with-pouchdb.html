<!DOCTYPE html>
<html lang="en" manifest="/manifest.appcache">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pagination strategies with PouchDB</title>
    <link rel="alternate" title="PouchDB, the JavaScript Database that Syncs!" type="application/rss+xml" href="/feed.xml">
    <link rel="stylesheet" href="/static/css/pouchdb.css" />
    <meta name="theme-color" content="#6ccb99">
    <meta name="msapplication-TileColor" content="#6ccb99">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42479701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
  </head>

  <body data-spy="scroll" data-target="#sidebar">

    <header>

      <a href="https://github.com/pouchdb/pouchdb" target="_blank">
         <div class="ribbon">GitHub</div>
      </a>

      <div class="container">

        <a class="logo" href="/">
          <div class="logo-img"></div>
          <span class='logo-type'>PouchDB</span>
        </a>

        <ul class='nav nav-header nav-pills'>
          <li>
            <a class='btn btn-link btn-lg' href="/blog/">Blog</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/guides/">Guides</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/api.html">API</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/learn.html">Learn</a>
          </li>
          <li>
            <a
                class='btn btn-primary btn-lg'
                href="https://github.com/pouchdb/pouchdb/releases/download/3.5.0/pouchdb-3.5.0.min.js"
            >
                Download <strong>v3.5.0</strong>
            </a>
          </li>
        </ul>

      </div>

    </header>
    
      <div class="page-head">

        <div class="container">

          <h1>Pagination strategies with PouchDB</h1>
          

        </div>

      </div>
    


    <article class='container'>
  <div class='row'>
    <div class='col-md-offset-1 col-md-10'>
      
  







  

  
    
      
    
    
      
    
  

  

  

  




<div class="post">
  <div class="media">
    <a class="pull-left" href="#">
    <img class="media-object img-circle img-responsive" src='https://gravatar.com/avatar/c436dec61b906e27c963518d0ef1d972' alt='Nolan Lawson'>
    </a>
    <div class="media-body">
    <p>
      <strong>By:</strong> <a href="https://twitter.com/nolanlawson">Nolan Lawson</a><br>
      <strong>Published:</strong> 14 April 2014<br>
      
    </p>
    </div>
  </div>
</div>


      <p>PouchDB, like CouchDB, was designed to store large amounts of data. However, once you&#39;re dealing with hundreds, thousands, or even millions of documents in a single database, proper pagination becomes crucial if you want to offer anything manageable to your users.  Nobody likes scrolling through a mile-high web page to try to find what they want.</p>

<h2>A basic example</h2>

<p>Let&#39;s pretend we&#39;re storing 20 documents in PouchDB:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">pouch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;numbers&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">docs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc01&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;uno&#39;</span><span class="p">},</span>        <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc02&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;dos&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc03&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;tres&#39;</span><span class="p">},</span>       <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc04&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;cuatro&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc05&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;cinco&#39;</span><span class="p">},</span>      <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc06&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;seis&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc07&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;siete&#39;</span><span class="p">},</span>      <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc08&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;ocho&#39;</span><span class="p">},</span> 
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc09&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;nueve&#39;</span><span class="p">},</span>      <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc10&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;diez&#39;</span><span class="p">},</span>  
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc11&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;once&#39;</span><span class="p">},</span>       <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc12&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;doce&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc13&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;trece&#39;</span><span class="p">},</span>      <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc14&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;catorce&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc15&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;quince&#39;</span><span class="p">},</span>     <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc16&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;dieciseis&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc17&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;diecisiete&#39;</span><span class="p">},</span> <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc18&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;dieciocho&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc19&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;diecinueve&#39;</span><span class="p">},</span> <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="s1">&#39;doc20&#39;</span><span class="p">,</span> <span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;veinte&#39;</span><span class="p">},</span>
<span class="p">];</span>
<span class="nx">pouch</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">({</span><span class="nx">docs</span> <span class="o">:</span> <span class="nx">docs</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle err or response</span>
<span class="p">});</span>
</code></pre></div>
<p>Now, the simplest kind of Pouch query, called <a href="http://pouchdb.com/api.html#batch_fetch"><code>allDocs()</code></a>, doesn&#39;t do any pagination by default.  As the name implies, it just returns all the docs:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">pouch</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle err or response</span>
<span class="p">});</span>
</code></pre></div>
<p>Here&#39;s the response:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc01&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;doc01&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-8e483b9e178a8e58e3f1a4690b3d6e9a&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc02&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;doc02&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-f6fee051188e84ac3d22c645c819a5d2&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="cm">/* etc. */</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc20&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;doc20&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-f6fee051188e84ac3d22c645c819a5d2&quot;</span><span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<div class="alert alert-warning">


<div class="alert-text">


<strong>Potential gotcha!</strong> Somewhat unintuitively, <code>allDocs()</code> doesn't return the full document data by default.  It only returns the document <code>id</code> and revision hash <code>rev</code>, unless you pass in the option <code>{include_docs : true}</code>.

</div></div>

<p>All 20 documents are returned, no pagination involved.  We can visualize it graphically like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">First doc returned                                    Last doc returned
 ↓                                                                   ↓ 
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
</code></pre></div>
<p>Now obviously, returning all 20 docs is nice, but we&#39;re here to paginate!  So let&#39;s see what we can pass to the <code>allDocs()</code> method to slice and dice our data.</p>

<h2>Learning the pagination lingo</h2>

<p><code>allDocs()</code> is a pretty flexible API, and we have a lot of parameters to choose from.  Since PouchDB is modeled after CouchDB, we can learn about these parameters by directly consulting <a href="https://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options">the Couch docs</a>, but here&#39;s a basic rundown:</p>

<ul>
<li><code>startkey</code>: the <code>_id</code> of the first doc we&#39;d like to fetch</li>
<li><code>endkey</code>: the <code>_id</code> of the last doc we&#39;d like to fetch</li>
<li><code>limit</code>: maximum number of docs to return</li>
<li><code>skip</code>: number of docs to skip</li>
<li><code>descending</code>: <code>true</code> if we want reverse ordering</li>
</ul>

<p>These parameters are simply passed as the first argument to <code>allDocs()</code>, e.g.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">pouch</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span><span class="nx">startkey</span> <span class="o">:</span> <span class="s1">&#39;doc05&#39;</span><span class="p">,</span> <span class="nx">endkey</span> <span class="o">:</span> <span class="s1">&#39;doc06&#39;</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle err or response</span>
<span class="p">});</span>
</code></pre></div>
<p>Here&#39;s the response:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc05&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;doc05&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-15397f81e784ee1a05d3ab6da07afe8d&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;doc06&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;doc06&quot;</span><span class="p">,</span>
      <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-5b35abcf7cc48e2cea63e64281f271ca&quot;</span><span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>Now, let&#39;s go through each of these parameters in detail.</p>

<h3>startkey and endkey</h3>

<p><code>startkey</code> simply tells PouchDB where you&#39;d like to start in the stream.  For instance, the options <code>{startkey : &#39;doc5&#39;}</code> would return these docs:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">      First doc returned                              Last doc returned
             ↓                                                       ↓ 
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
</code></pre></div>
<p>Similarly, <code>endkey</code> tells PouchDB where to stop reading.  <code>{endkey : &#39;doc15&#39;}</code> would give us:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">First doc returned                         Last doc returned
 ↓                                               ↓ 
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
</code></pre></div>
<p>These two options can be used together!  <code>{startkey : &#39;doc5&#39;, endkey: &#39;doc15&#39;}</code> gives us:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">      First doc returned                   Last doc returned
             ↓                                   ↓ 
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
</code></pre></div>
<p>Notice that both <code>startkey</code> and <code>endkey</code> are <em>inclusive</em> &mdash; i.e., the matching value itself is included in the results.</p>

<p>However, the value doesn&#39;t actually need to be present. So for example, if you have the documents <code>[&#39;A&#39;, &#39;B&#39;, &#39;X&#39;, &#39;Y&#39;]</code>, calling <code>{startkey : &#39;C&#39;, endkey : &#39;Z&#39;}</code> would return <code>[&#39;X&#39;, &#39;Y&#39;]</code>.</p>

<h3>skip and limit</h3>

<p><code>skip</code> tells PouchDB how many documents to skip from its normal starting point.  E.g. <code>{skip : 5}</code> gives us:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">      First doc returned                              Last doc returned
             ↓                                                       ↓ 
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
</code></pre></div>
<p>Whereas <code>limit</code> does the opposite: it cuts off documents from the end. <code>{limit : 15}</code> only gives us the first 15 docs:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">First doc returned                         Last doc returned
 ↓                                               ↓ 
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
</code></pre></div>
<p>When <code>skip</code> and <code>limit</code> are used together, <code>limit</code> applies after <code>skip</code>.  So e.g. <code>{skip : 5, limit : 10}</code> would slice your documents like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">         First doc returned                Last doc returned
                ↓                                ↓ 
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
</code></pre></div>
<h3>Skipping into a trap</h3>

<p>If you come from a SQL background, you might recognize <code>skip</code> and <code>limit</code> as our old friends from SQL: <code>OFFSET</code> and <code>LIMIT</code>. You might also imagine that these parameters are the only ones you need for proper pagination.  But this is a trap!</p>

<h4>Dumb method (do not use!)</h4>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">fetchNextPage</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">pouch</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span><span class="nx">limit</span> <span class="o">:</span> <span class="nx">pageSize</span><span class="p">,</span> <span class="nx">skip</span> <span class="o">:</span> <span class="nx">offset</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">offset</span> <span class="o">+=</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="c1">// handle err or response</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>This method is intuitive, but once <code>skip</code> grows to a large number, your performance will start to degrade pretty drastically.  That&#39;s because those documents must literally be <em>skipped</em> over with each query, and the database will still read into memory every document that it&#39;s skipping. This can be really bad for performance, especially on mobile devices with constrained memory.</p>

<p>Just repeat to yourself: <code>skip</code> really means &quot;skip&quot;!</p>

<h4>Smart method (please use!)</h4>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">limit</span> <span class="o">:</span> <span class="mi">5</span><span class="p">};</span>
<span class="kd">function</span> <span class="nx">fetchNextPage</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">pouch</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span> <span class="o">&amp;&amp;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">startkey</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">skip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// handle err or response</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>This method takes a bit more time to grok, but what it&#39;s essentially doing is leveraging <code>startkey</code>, instead of relying on the performance-killer <code>skip</code>.</p>

<p>In our initial query, we simply tell PouchDB to give us the first 5 documents (or 10, or whatever your page size is).  In our subsequent queries, we tell it to start with the last doc from the previous page, and to <code>skip</code> that one doc.</p>

<p>Of course, you could also fetch <code>pageSize + 1</code> docs each time, and simply omit the last document when you display the results to the user.  The choice is yours, but either method is preferable to using <code>skip</code> and <code>limit</code> alone.</p>

<div class="alert alert-info">


<div class="alert-text">


<strong>Aside</strong>: To be fair, WebSQL and CouchDB (since <a href='https://issues.apache
.org/jira/browse/COUCHDB-977'>version 1.1.1</a>) do not
suffer from this problem, due to their ability to efficiently count SQLite rows/B-tree offsets.
However, since IndexedDB and LevelDB (and other backends modeled on <a href='https://github
.com/rvagg/node-leveldown/'>LevelDOWN</a>) are
traditional key-value stores, they don't have a good way to count offsets.  Also, some <a href='http://danielwertheim.se/2014/04/01/couchdb-pagination-is-skip-and-limit-enough/
'>experimental data</a> suggests that CouchDB 1.5 is still faster with the <code>startkey</code> pattern. So you're better off just using <code>startkey</code> everywhere.

</div></div>

<h2>Paginating in backwards land</h2>

<p>When <code>descending</code> is set to <code>true</code>, the normal document order is reversed.  Simply passing <code>{descending : true}</code> would give us:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">First doc returned                                    Last doc returned
 ↓                                                                   ↓ 
[20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
</code></pre></div>
<p>Additionally, all the other parameters suddenly work backwards from their normal behavior!  For instance, if we want to fetch the documents from <code>&#39;doc01&#39;</code> to <code>&#39;doc10&#39;</code>, we&#39;d normally do:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">pouch</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span><span class="nx">startkey</span> <span class="o">:</span> <span class="s1">&#39;doc01&#39;</span><span class="p">,</span> <span class="nx">endkey</span> <span class="o">:</span> <span class="s1">&#39;doc10&#39;</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle err or response</span>
<span class="p">});</span>
</code></pre></div>
<p>This would give us 10 results, as expected:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">First doc returned     Last doc returned
 ↓                           ↓ 
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
</code></pre></div>
<p>If we set <code>descending</code> to <code>true</code>, though, we&#39;re in backwards land! So that same query will give us zero results:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">                                       Last doc???         First doc???
                                          ↓                          ↓ 
[20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
</code></pre></div>
<p>Here&#39;s the actual JavaScript <code>response</code> object:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[]</span>
<span class="p">}</span>
</code></pre></div>
<p>Whenever <code>descending</code> is set to <code>true</code>, we need to switch the <code>startkey</code> and <code>endkey</code> to get the results we want:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">pouch</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span><span class="nx">startkey</span> <span class="o">:</span> <span class="s1">&#39;doc10&#39;</span><span class="p">,</span> <span class="nx">endkey</span> <span class="o">:</span> <span class="s1">&#39;doc01&#39;</span><span class="p">,</span> <span class="nx">descending</span> <span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle err or response</span>
<span class="p">});</span>
</code></pre></div>
<p>This gives us what we expect:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">                               First doc returned     Last doc returned
                                          ↓                          ↓ 
[20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
</code></pre></div>
<h3>Skip and limit in backwards land</h3>

<p>Similarly, for <code>skip</code> and <code>limit</code>, the operations are performed on the reversed list.  Setting <code>skip</code> to <code>5</code> will skip the &quot;first&quot; 5 documents, so <code>{skip : 5, descending : true}</code> returns:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">               First doc returned                     Last doc returned
                      ↓                                              ↓ 
[20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
</code></pre></div>
<p>And setting <code>limit</code> to <code>15</code> will give us the &quot;first&quot; 15 documents, so <code>{limit : 15, descending : true}</code> gives us:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">First doc returned                              Last doc returned
  ↓                                                   ↓ 
[20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
</code></pre></div>
<p>Of course, you&#39;re free to go nuts and combine these parameters together. For example, the somewhat bloated options:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="nx">skip</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">limit</span> <span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nx">startkey</span> <span class="o">:</span> <span class="s1">&#39;doc10&#39;</span><span class="p">,</span>
  <span class="nx">descending</span> <span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>
<p>would give us:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">                             First doc returned    Last doc returned
                                             ↓           ↓ 
[20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
</code></pre></div>
<h2>Keeping your strings in order</h2>

<p>In the examples up to now, I&#39;ve been careful to name my documents <code>&#39;doc01&#39;</code>, <code>&#39;doc02&#39;</code>, etc.  Astute readers might wonder if that&#39;s because PouchDB uses standard <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String#Comparing_strings">JavaScript string ordering</a>.  And those smarty-pants readers would be correct!  Since <code>doc2</code> comes after <code>doc10</code> in lexicographical ASCII order, I pad the single digits with zeroes.</p>

<p>This can be a very useful trick for document sorting.  Normally, PouchDB will generate a random doc ID if you don&#39;t specify one (e.g. <code>&#39;36483B8A-DF4A-4AEB-B946-096BA0FA8813&#39;</code>), but if you provide your own IDs, you can make sorting incredibly easy for a variety of applications.</p>

<h3>Example: sort by date</h3>

<p>Let&#39;s imagine we want to sort our documents by date. For the doc IDs, we&#39;ll use timestamps in <a href="http://www.w3.org/TR/NOTE-datetime">standard ISO-8601 format</a>, given by <code>new Date().toJSON()</code>. This guarantees proper lexicographical ordering:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">partyLikeIts</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">915148800000</span><span class="p">);</span> <span class="c1">// 1999</span>
<span class="kd">var</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">1394841840000</span><span class="p">);</span>         <span class="c1">// 2014</span>

<span class="nx">partyLikeIts</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="c1">// &quot;1999-01-01T00:00:00.000Z&quot;</span>
<span class="nx">now</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span>          <span class="c1">// &quot;2014-03-15T00:04:00.000Z&quot;</span>

<span class="c1">// Party on!</span>
<span class="nx">partyLikeIts</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">now</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span> <span class="c1">// true</span>
</code></pre></div>
<div class="alert alert-warning">


<div class="alert-text">


<strong>Note:</strong> If you're worried about ID collisions, you could also use <code>new Date().toJSON() + Math.random()</code>.

</div></div>

<p>Now we can fetch the 10 most recent docs:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="nx">limit</span> <span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nx">descending</span> <span class="o">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>
<p>Or the first 10 docs published after January 1st, 2000:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="nx">limit</span> <span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nx">startkey</span> <span class="o">:</span> <span class="s1">&#39;2000-01-01T00:00:00.000Z&#39;</span>
<span class="p">}</span>
</code></pre></div>
<p>And if you need fancier sorting, or more than one index, try the Map/Reduce-powered <a href="http://pouchdb.com/api.html#query_database"><code>query()</code> API</a>, which boasts <a href="http://docs.couchdb.org/en/latest/couchapp/views/collation.html#collation-specification">complex key collation</a>.</p>

<h2>total_rows is totally awesome</h2>

<p>When we call <code>allDocs()</code>, a typical response object looks like this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[</span><span class="cm">/* results go here */</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p><code>offset</code> simply tells us how many documents were <code>skip</code>ped, but <code>total_rows</code> tells us the total number of docs in our database.  This can be very useful if you want to calculate how many documents are left to be read in, or if you just want to quickly fetch the database size.</p>

<p>For instance, calling <code>allDocs()</code> with <code>{limit : 0}</code> will simply return an empty list:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[]</span>
<span class="p">}</span>
</code></pre></div>
<p>If you&#39;re a SQL jockey, you can think of this as your <code>COUNT(*)</code>.</p>

<h2>Putting it all together</h2>

<p>PouchDB and CouchDB handle pagination like it ain&#39;t no thing.  There are more advanced topics, like how to page through Map/Reduce views with the <code>query()</code> API, but if you understand <code>allDocs()</code>, you&#39;re already 75% of the way there.</p>

<p>So congratulations, you&#39;re now a <a href="https://en.wikipedia.org/wiki/Pagemaster">Page Master</a>!  Try to use your newfound powers for good.</p>

        </div>
  </div>
</article>


    <div class="icons">

      <div class="container">

        <div class="row">

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://twitter.com/pouchdb' target='_blank'>
              <div class="icon icon-twitter"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/rvagg/node-levelup' target='_blank'>
              <div class="icon icon-leveldb"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-github"></div>
            </a>
            </div>

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://travis-ci.org/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-travis"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='http://couchdb.apache.org/' target='_blank'>
              <div class="icon icon-couchdb"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://saucelabs.com' target='_blank'>
              <div class="icon icon-saucelabs"></div>
            </a>
          </div>

        </div>

      </div>

    </div>

    <footer class="footer">

      <div class="container">

        <div class="row">

          <div class='col-sm-3'>
            <h3 class="nav-head">Learn</h3>
            <ul class='nav nav-silent'>
              <li><a href="/getting-started.html">Getting Started</a></li>
              <li><a href="/api.html">API Guide</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/wiki">Wiki</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Discuss</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://groups.google.com/forum/#!forum/pouchdb">Mailing List</a></li>
              <li><a href="irc://freenode.net/#pouchdb">IRC</a></li>
              <li><a href="http://twitter.com/pouchdb">Twitter</a></li>
              <li><a href="http://stackoverflow.com/questions/tagged/pouchdb">StackOverflow</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Contribute</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/CONTRIBUTING.md">Contributing</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb">Source</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/issues">Issues</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/LICENSE">Apache License</a></li>
            </ul>
          </div>

        </div>

      </div>

    </footer>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/code.min.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/pouchdb/latest/pouchdb.min.js"></script>
    <script type="text/javascript">
      function onCached(e) {
        if (applicationCache.status === 1) {
          giveIntro();
        }
      }
      
      function giveIntro() {
        console.log('%c\n..............................................................................\n.?I...........~+: ............................................................\n.???.........++++.............................................................\n:????+......+++++.............................................................\n.??????+++++++++:.................................H...........D..B............\n...????++++++++...................................H...........D..B............\n...=????++++++.......PPPPP...OOOO...U....U...CCCC.HHHHH...DDDDD..BBBBB........\n...?????+++++++......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n..???????+++++++ ....P. ..P.O....O..U....U.CC.....H...H..D....D..B....B.......\n..?????????????......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n...I??????????~......PPPPP...OOOO...=UUUUU...CCCC.H...H...DDDDD..BBBBB........\n....?????????~.......P.... ...................................................\n.....???????+........P........................................................\n......??????..................................................................\n..............................................................................\n..............................................................................\n..............................................................................', 'color: #4ec084');
        console.log('%c\nPouchDB itself is hosted at PouchDB.com!\nTo get started, try typing:\nvar db = new PouchDB(\'mydb\');', 'color: #4ec084');
      }
      applicationCache.addEventListener('cached', onCached, false);
      applicationCache.addEventListener('noupdate', giveIntro, false);
    </script>
  </body>
</html>
